var is=Object.defineProperty,ls=Object.defineProperties;var rs=Object.getOwnPropertyDescriptors;var Mt=Object.getOwnPropertySymbols;var us=Object.prototype.hasOwnProperty,cs=Object.prototype.propertyIsEnumerable;var ft=(e,t,s)=>t in e?is(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,pt=(e,t)=>{for(var s in t||(t={}))us.call(t,s)&&ft(e,s,t[s]);if(Mt)for(var s of Mt(t))cs.call(t,s)&&ft(e,s,t[s]);return e},mt=(e,t)=>ls(e,rs(t));var S=(e,t,s)=>(ft(e,typeof t!="symbol"?t+"":t,s),s);import{d as ie,r as L,_ as ce,o as h,c as p,F as M,a as Z,n as j,t as T,b as nt,e as he,f as Ae,g as He,h as l,i as X,j as Ot,k as V,l as We,m as ds,w as q,v as Q,p as Te,q as hs,s as Ie,u as Ce,x as Ze,y as fs,z as ps,A as Qe,B as ms,C as ne,D as de,E as ve,G as Nt,H as ye,I as D,J as _s,K as gs}from"./index.a1aa8a25.js";class zt{constructor(t,s){S(this,"symbol");S(this,"value");S(this,"children");this.symbol=t,typeof s=="string"?(this.value=s,this.children=[]):(this.value="",this.children=s)}toString(){return this.pretty(0)}pretty(t){let n=" ".repeat(t*2)+this.symbol.name;return this.symbol.isTerm&&(n+="("+this.value+")"),n+=`
`,this.children.forEach(o=>{n+=o.pretty(t+1)}),n}}class ae extends Error{constructor(s,n){super(s.toString());S(this,"extra");this.extra=n}}class Fe extends Error{constructor(s,n){super(s.toString());S(this,"extra");this.extra=n}}const J={FATAL_ERROR:1e3,INVALID_OPERATION:1001,DESERIALIZE_FAILED:1002,LR_ITEM_INDEX_OUT_OF_RANGE:1011,AUTOMATON_STATES_NOT_FOUND:1031,START_SYMBOL_NOT_FOUND:1051,UNEXPECTED_TOKEN:1052,TOKEN_LIST_INDEX_OUT_OF_RANGE:1053,LR_ITEM_SET_CLOSURE_HAVE_CALCULATED:2021,AUTOMATON_STATE_CLOSURE_NEED_CALCULATE:2031,AUTOMATON_STATE_CLOSURE_HAVE_APPENDED:2032,LOOKAHEADS_HAVE_PROPAGATED:2033,NEED_SPONTANEOUSLY_GENERATE:2034,PARSE_TABLE_HAVE_CALCULATED:2041,PARSE_TABLE_NEED_CALCULATE:2051,PARSER_DONE:2052};class Ke{constructor(t){S(this,"name");S(this,"isTerm",!1);this.name=t}static deserialize(t){let s=t.__type__;if(s===Ue._type)return new Ue(t.name);if(s===Tt._type)return new Tt(t.name);throw new ae(J.DESERIALIZE_FAILED)}eq(t){return this.isTerm===t.isTerm&&this.name===t.name}}class Ue extends Ke{constructor(s){super(s);S(this,"isTerm",!0)}}S(Ue,"_type","Terminal");class Tt extends Ke{constructor(s){super(s);S(this,"isTerm",!1)}}S(Tt,"_type","NonTerminal");const vs="start",Xe=new Ue(vs),ys="$",Me=new Ue(ys),ws="\u03B5",jt=new Ue(ws),Ss="#",Et=new Ue(Ss),ut=class{constructor(t,s,n,o){S(this,"origin");S(this,"expansion");S(this,"order");S(this,"priority");this.origin=t,this.expansion=s,this.order=n,this.priority=o}static deserialize(t){if(t.__type__!==ut._type)throw new ae(J.DESERIALIZE_FAILED);return new ut(Ke.deserialize(t.origin),t.expansion.map(n=>Ke.deserialize(n)),t.order,t.options.priority?t.options.priority:0)}toString(){let t="";t+=this.origin.name+" \u2192 ";for(let s=0;s<this.expansion.length;s++)s===0?t+=this.expansion[s].name:t+=" "+this.expansion[s].name;return t}};let rt=ut;S(rt,"_type","Rule");const ct=class{constructor(t,s,n,o,u,i,a,r){S(this,"type");S(this,"symbol");S(this,"value");S(this,"startPos");S(this,"line");S(this,"column");S(this,"endLine");S(this,"endColumn");S(this,"endPos");this.type=t,this.symbol=Et,this.value=s,this.startPos=n,this.line=o,this.column=u,this.endLine=i,this.endColumn=a,this.endPos=r}static deserialize(t){if(t.__type__!==ct._type)throw new ae(J.DESERIALIZE_FAILED);return new ct(t.type,t.value,t.start_pos,t.line,t.column,t.end_line,t.end_column,t.end_pos)}};let je=ct;S(je,"_type","Token");const it={DOT:".",COMMA:",",COLON:":",SEMICOLON:";",PLUS:"+",MINUS:"-",STAR:"*",SLASH:"/",BACKSLASH:"\\",VBAR:"|",QMARK:"?",BANG:"!",AT:"@",HASH:"#",DOLLAR:"$",PERCENT:"%",CIRCUMFLEX:"^",AMPERSAND:"&",UNDERSCORE:"_",LESSTHAN:"<",MORETHAN:">",EQUAL:"=",DBLQUOTE:'"',QUOTE:"'",BACKQUOTE:"`",TILDE:"~",LPAR:"(",RPAR:")",LBRACE:"{",RBRACE:"}",LSQB:"[",RSQB:"]"};class Ve{constructor(t,s=0,n){S(this,"rule");S(this,"index");S(this,"lookahead");if(s>t.expansion.length)throw new ae(J.LR_ITEM_INDEX_OUT_OF_RANGE);this.rule=t,this.index=s,n===void 0?this.lookahead=new Set:n instanceof Ke?(this.lookahead=new Set,this.lookahead.add(n)):this.lookahead=new Set([...n])}toString(){let t="[ "+this.rule.origin.name+" ->";for(let s=0;s<this.rule.expansion.length;s++)t+=" ",s===this.index&&(t+="\xB7"),t+=this.rule.expansion[s].name;if(this.lookahead.size===0)return t+(this.end()?"\xB7":"")+" ]";{t+=this.end()?"\xB7, ":", ";let s=!0;return this.lookahead.forEach(n=>{s?s=!1:t+="/",t+=n.name}),t+" ]"}}equal(t){return t.lookahead.size!==this.lookahead.size?!1:this.equalIncludes(t)}equalIncludes(t){for(let s of t.lookahead)if(!this.lookahead.has(s))return!1;return t.rule===this.rule&&t.index===this.index}equalLR0(t){return t.rule===this.rule&&t.index===this.index}end(){return this.index===this.rule.expansion.length}current(){return this.rule.expansion[this.index]}advance(){return new Ve(this.rule,this.index+1,this.lookahead)}appendLookahead(t){let s=this.lookahead.size;return t instanceof Ke?this.lookahead.add(t):this.lookahead=new Set([...this.lookahead,...t]),this.lookahead.size!==s}clearLookahead(){this.lookahead.clear()}clone(){return new Ve(this.rule,this.index,this.lookahead)}}class _t{constructor(t,s){S(this,"kernel");S(this,"closure");S(this,"id",0);S(this,"closureDone",!1);S(this,"accepting",!1);S(this,"end",!1);S(this,"appended",!1);S(this,"searchIndex",0);this.kernel=t,this.id=s,this.closure=[],this.kernel.forEach(n=>{this.closure.push(n),n.current()||(this.accepting=!0,n.rule.origin===Xe&&(this.end=!0))})}toString(){let t="ItemSet "+this.id.toString()+`: 
`;return this.closureDone?this.closure.forEach(s=>{t+=s.toString()+`
`}):t+="Closure not calculated.",t+="------------",t}initClosure(){this.closure=[],this.closureDone=!1,this.searchIndex=0,this.kernel.forEach(t=>{this.closure.push(t)})}equal(t){return this.kernelEqual(t.kernel)}kernelEqual(t){if(this.kernel.length!==t.length)return!1;for(let s=0;s<t.length;s++)if(!this.inKernel(t[s]))return!1;return!0}inKernel(t){for(let s=0;s<this.kernel.length;s++)if(t.equal(this.kernel[s]))return!0;return!1}calcClosure(t){if(this.closureDone)throw new Fe(J.LR_ITEM_SET_CLOSURE_HAVE_CALCULATED);let s=[];for(;!this.closureDone;){let n={step:[]},o=this.closure[this.searchIndex];const u=o.current();for(let i of $.rules)if(u===i.origin){if(t==="LR0"){let a=new Ve(i,0);this.have(a)?n.step.push({item:a,existed:!0}):(n.step.push({item:a,existed:!1}),this.closure.push(a))}else if(t==="LR1"){let a=o.rule.expansion.slice(o.index+1);n.first=[],o.lookahead.forEach(r=>{const d=[...a,r];let c=Ts(d);c.forEach(f=>{var I,O;let g=new Ve(i,0,f);this.have(g)?((O=n.first)==null||O.push({symbolString:d,firstSet:c}),n.step.push({item:g,existed:!0})):((I=n.first)==null||I.push({symbolString:d,firstSet:c}),n.step.push({item:g,existed:!1}),this.closure.push(g))})})}}this.searchIndex++,this.searchIndex===this.closure.length&&(this.closureDone=!0),s.push(n)}return s}have(t){for(let s=0;s<this.closure.length;s++)if(this.closure[s].equalIncludes(t))return!0;return!1}lr0kernelEqual(t){if(this.kernel.length!==t.kernel.length)return!1;for(let s=0;s<t.kernel.length;s++){let n=!1;for(let o=0;o<this.kernel.length;o++)if(t.kernel[s].equalLR0(this.kernel[o])){n=!0;break}if(!n)return!1}return!0}mergeLookaheads(){let t=[];for(let s=this.kernel.length;s<this.closure.length;s++){let n=!1;for(let o=0;o<t.length;o++)if(t[o].rule===this.closure[s].rule&&t[o].index===this.closure[s].index){n=!0,t[o].lookahead=new Set([...t[o].lookahead,...this.closure[s].lookahead]);break}n||t.push(this.closure[s].clone())}this.closure=[...this.kernel,...t]}mergeLr1ItemSet(t){t.closure.forEach(s=>{for(let n=0;n<this.closure.length;n++)this.closure[n].equalLR0(s)&&(this.closure[n].lookahead=new Set([...this.closure[n].lookahead,...s.lookahead]))})}getItemIndex(t){for(let s=0;s<this.kernel.length;s++)if(this.kernel[s].equal(t))return s;return-1}}class Ls{constructor(t){S(this,"states",[]);S(this,"done",!1);S(this,"type");S(this,"transitions",new Map);S(this,"transitionsRule",new Map);S(this,"effects",[]);S(this,"propagated",!1);S(this,"spontaneouslyGenerated",!1);this.type=t;let s=new _t([new Ve($.startRule,0,this.type==="LR0"||this.type==="LR0_LALR1"?void 0:Me)],0);this.states.push(s)}toString(){let t="";return this.states.forEach(s=>{s!==void 0&&(t+=s.toString()+`
`)}),t}CalcStateClosure(t,s){if(this.states[t]===void 0)throw new ae(J.AUTOMATON_STATES_NOT_FOUND);let n;return s==="LR0"||s==="LR0_LALR1"?n=this.states[t].calcClosure("LR0"):n=this.states[t].calcClosure("LR1"),{state:this.states[t],steps:n}}AppendStates(t){if(this.states[t]===void 0)throw new ae(J.AUTOMATON_STATES_NOT_FOUND);let s=this.states[t];if(!s.closureDone){let r=!1;for(let d=0;d<s.kernel.length;d++){let c=s.kernel[d].current();c===void 0||c.isTerm||(r=!0)}if(r)throw new Fe(J.AUTOMATON_STATE_CLOSURE_NEED_CALCULATE);s.closureDone=!0}if(s.appended)throw new Fe(J.AUTOMATON_STATE_CLOSURE_HAVE_APPENDED);s.appended=!0;let n=new Map,o=new Map;s.closure.forEach(r=>{if(!r.end()){let d=r.current();n.has(d)||n.set(d,[]),n.get(d).push(r.advance());let c=o.get(d);(c===void 0||r.rule.priority>c.priority||r.rule.priority===c.priority&&r.rule.order>c.order)&&o.set(d,r.rule)}}),this.transitionsRule.set(t,o);let u=this.states.length,i=new Map,a=[];return n.forEach((r,d)=>{let c=-1;for(let f=0;f<u;f++)if(this.states[f].kernelEqual(r)){c=f;break}if(c===-1){c=this.states.length;let f=new _t(r,c),g=!1,I=!1;for(let O=0;O<f.kernel.length;O++){let P=f.kernel[O].current();P!==void 0&&(I=!0,P.isTerm||(g=!0))}f.closureDone=!g,f.appended=!I,this.states.push(f)}i.set(d,c),a.push({symbol:d,state:this.states[c]})}),this.transitions.set(t,i),{from:t,targets:a}}MergeLookaheads(t){if(this.states[t]===void 0)throw new ae(J.AUTOMATON_STATES_NOT_FOUND);return this.states[t].mergeLookaheads(),this.states[t]}mergeLr1(){if(this.type!=="LR1_LALR1")throw new ae(J.INVALID_OPERATION);let t=new Map;for(let n=0;n<this.states.length;n++)if(this.states[n]!==void 0)for(let o=n+1;o<this.states.length;o++)this.states[o]!==void 0&&this.states[n].lr0kernelEqual(this.states[o])&&(t.set(this.states[o].id,this.states[n].id),this.states[n].mergeLr1ItemSet(this.states[o]),this.transitions.delete(this.states[o].id),delete this.states[o]);const s=new Map;return this.states.forEach(n=>{let o=this.transitions.get(n.id);if(o===void 0)return;let u=o.entries(),i=[];for(let a of u){let r=t.get(a[1]);r!==void 0&&(o.set(a[0],r),i.push({symbol:a[0],from:a[1],to:r}))}i.length!==0&&s.set(n.id,i)}),{mergeMap:t,transitionChanges:s}}propagatedAndSpontaneouslyGenerate(){if(this.type!=="LR0_LALR1")throw new ae(J.INVALID_OPERATION);let t=new Map;return t.set(0,new Map().set(0,new Set([Me]))),this.states.forEach(s=>{let n=[];s.kernel.forEach(o=>{if(o.end()){n.push([]);return}let u=[],i=new _t([new Ve(o.rule,o.index,Et)],-1);i.calcClosure("LR1"),i.closure.forEach(a=>{if(a.end())return;let r=Array.from(a.lookahead)[0],c=this.transitions.get(s.id).get(a.current());if(c===void 0)throw new ae(J.FATAL_ERROR);let f=a.advance();f.clearLookahead();let g=this.states[c].getItemIndex(f);if(g===-1)throw new ae(J.FATAL_ERROR);if(r===Et)u.push([c,g]);else{t.has(c)||t.set(c,new Map);let I=t.get(c);I.has(g)||I.set(g,new Set),I.get(g).add(r)}}),n.push(u)}),this.effects.push(n)}),t.forEach((s,n)=>{s.forEach((o,u)=>{this.states[n].kernel[u].appendLookahead(o)})}),t}pass(){if(this.type!=="LR0_LALR1")throw new ae(J.INVALID_OPERATION);if(this.propagated)throw new ae(J.LOOKAHEADS_HAVE_PROPAGATED);if(!this.spontaneouslyGenerated)throw new ae(J.NEED_SPONTANEOUSLY_GENERATE);let t=!1;this.states.forEach(s=>s.kernel.forEach((n,o)=>{this.effects[s.id][o].forEach(i=>{let a=this.states[i[0]].kernel[i[1]].appendLookahead(n.lookahead);t=t||a})})),t||(this.propagated=!0)}reCalc(){if(this.type!=="LR0_LALR1")throw new ae(J.INVALID_OPERATION);this.states.forEach(t=>{t.initClosure(),t.calcClosure("LR1"),t.mergeLookaheads()})}}class dt{constructor(t,s,n,o){S(this,"name");S(this,"abbr");S(this,"arg");S(this,"rule");this.name=t,this.abbr=s,this.arg=n,this.rule=o}toString(){return this.abbr+(this.name==="Accept"?"":this.arg.toString())}}class gt extends dt{constructor(t,s){super("Shift","s",t,s)}}class Dt extends dt{constructor(t,s){super("Reduce","r",t,s)}}class vt extends dt{constructor(t,s){super("Goto","g",t,s)}}class ks extends dt{constructor(){super("Accept","acc",-1,$.startRule)}}class bs{constructor(t){S(this,"actionTable",new Map);S(this,"gotoTable",new Map);S(this,"actionHeader",[]);S(this,"gotoHeader",[]);S(this,"conflict",!1);S(this,"done",!1);S(this,"automaton");this.automaton=t}toString(){let t=[],s=[],n=[];$.symbolMap.forEach((c,f)=>{c!==Xe&&(c.isTerm?s.push(f):n.push(f))});let o=[...s,...n];this.automaton.states.forEach((c,f)=>{let g=[f.toString()];o.forEach(I=>{let O=$.symbolMap.get(I),P=O.isTerm?this.actionTable.get(c.id).get(O):this.gotoTable.get(c.id).get(O);g.push(P?P.toString():"")}),t.push(g)}),o=["",...o],t=[o,...t];let u=[];for(let c=0;c<t[0].length;++c){let f=0;t.forEach(g=>{f=Math.max(f,g[c].length)}),u.push(f)}let i=s.length-1,a=n.length-1;for(let c=0;c<s.length;c++)i+=u[c+1];for(let c=0;c<n.length;c++)a+=u[c+s.length+1];i=Math.max(i,6),a=Math.max(a,4);let r=u[0]+i+a+2,d="";return d+="-".repeat(r+2)+`
`,d+="|"+" ".repeat(u[0])+"|ACTION"+" ".repeat(i-6)+"|GOTO"+" ".repeat(a-4)+`|
`,t.forEach(c=>{d+="-".repeat(r+2)+`
|`,c.forEach((f,g)=>{d+=f+" ".repeat(u[g]-f.length)+"|"}),d+=`
`}),d+="-".repeat(r+2),d}insert(t,s,n,o){let u=t.get(s).get(n);u===void 0?t.get(s).set(n,[o]):(this.conflict=!0,u.push(o),u.sort((i,a)=>{if(i instanceof vt||a instanceof vt)throw new ae(J.FATAL_ERROR);return i.rule.priority===a.rule.priority?i.rule.origin===a.rule.origin&&a.rule.order!==i.rule.order?a.rule.order-i.rule.order:i instanceof gt?-1:a instanceof gt?1:0:a.rule.priority-i.rule.priority}))}calc(){if(this.done)throw new Fe(J.PARSE_TABLE_HAVE_CALCULATED);$.symbolMap.forEach(t=>{t!==Xe&&(t.isTerm?this.actionHeader.push(t):this.gotoHeader.push(t))}),this.actionTable=new Map,this.gotoTable=new Map,this.automaton.states.forEach(t=>{this.actionTable.set(t.id,new Map),this.gotoTable.set(t.id,new Map);let s=t.id,n=this.automaton.transitions.get(s);n==null||n.forEach((o,u)=>{let i=this.automaton.transitionsRule.get(s).get(u);if(i===void 0)throw new ae(J.FATAL_ERROR);u.isTerm?this.insert(this.actionTable,s,u,new gt(o,i)):this.insert(this.gotoTable,s,u,new vt(o,i))}),t.closure.forEach(o=>{o.end()&&(o.rule.origin===Xe?this.insert(this.actionTable,s,Me,new ks):this.automaton.type==="LR0"?$.symbolMap.forEach(u=>{this.insert(this.actionTable,s,u,new Dt($.ruleIndexMap.get(o.rule),o.rule))}):o.lookahead.forEach(u=>{this.insert(this.actionTable,s,u,new Dt($.ruleIndexMap.get(o.rule),o.rule))}))})}),this.done=!0}get(t,s,n){let u=(t==="ACTION"?this.actionTable:this.gotoTable).get(s).get(n);return u===void 0?u:u[0]}}const $={rules:[],startRule:void 0,ruleIndexMap:new Map,symbolMap:new Map,tokens:[],firstSet:new Map,nullable:new Set,stateStack:[],valueStack:[],reset:function(){this.rules=[],this.startRule=void 0,this.ruleIndexMap=new Map,this.symbolMap=new Map,this.tokens=[],this.firstSet=new Map,this.nullable=new Set,this.stateStack=[],this.valueStack=[]}};function Bt(e,t){if(t.size>e.size)return!1;let s=t.values();for(let n of s)if(!e.has(n))return!1;return!0}function Ts(e){let t=new Set;for(let s=0;s<e.length;++s){if(e[s].isTerm){t=new Set([...t,e[s]]);break}if(t=new Set([...t,...$.firstSet.get(e[s])]),!$.nullable.has(e[s]))break;s===e.length-1&&t.add(jt)}return Array.from(t)}class Es{constructor(t,s,n,o){S(this,"algo");S(this,"automaton");S(this,"current");S(this,"parseTable");S(this,"tokenPtr",-1);S(this,"done",!1);S(this,"store",$);$.reset(),this.algo=t,o||(s.forEach(a=>{a.expansion.forEach(r=>{it[r.name]!==void 0&&(r.name=it[r.name])})}),n.forEach(a=>{it[a.type]!==void 0&&(a.type=it[a.type])})),$.rules=s,$.tokens=n;const u=a=>($.symbolMap.has(a.name)||$.symbolMap.set(a.name,a),$.symbolMap.get(a.name));if(u(Xe),u(Me),$.rules.forEach((a,r)=>{a.origin.name===Xe.name&&($.startRule=a),a.origin=u(a.origin),a.expansion.forEach((d,c,f)=>{f[c]=u(d)}),$.ruleIndexMap.set(a,r)}),!$.startRule)throw new ae(J.START_SYMBOL_NOT_FOUND);$.tokens.forEach(a=>{const r=$.symbolMap.get(a.type);if(r===void 0)throw new ae(J.FATAL_ERROR);a.symbol=r});const i=new je(Me.name,Me.name,0,0,0,0,0,0);i.symbol=Me,$.tokens.push(i),this.automaton=new Ls(this.algo),this.parseTable=new bs(this.automaton),this.algo!=="LR0"&&this.calcFirstSet(),$.stateStack.push(0),this.current=this.nextToken()}calcFirstSet(){let t=!0;$.symbolMap.forEach(s=>{$.firstSet.set(s,s.isTerm?new Set([s]):new Set)});do t=!0,$.rules.forEach(s=>{if(s.expansion.length===0||Bt($.nullable,new Set([...s.expansion]))){let n=$.nullable.size;$.nullable.add(s.origin),$.nullable.size===n||(t=!1)}for(let n=0;n<s.expansion.length;n++)if(n===0||Bt($.nullable,new Set(s.expansion.slice(0,n)))){let o=$.firstSet.get(s.origin).size;$.firstSet.set(s.origin,new Set([...$.firstSet.get(s.origin),...$.firstSet.get(s.expansion[n])])),$.firstSet.get(s.origin).size===o||(t=!1)}});while(!t)}getFirstSet(){return{firstSet:$.firstSet,nullable:$.nullable,SYMBOL_EPSILON:jt}}calcParseTable(){return this.parseTable.calc(),this.parseTable}parseByStep(){if(!this.parseTable.done)throw new Fe(J.PARSE_TABLE_NEED_CALCULATE);if(this.done)throw new Fe(J.PARSER_DONE);let t=$.stateStack[$.stateStack.length-1],s=this.current.symbol,n,o=this.parseTable.get(s.isTerm?"ACTION":"GOTO",t,s);if(o===void 0)throw new ae(J.UNEXPECTED_TOKEN,this.current.value);if(o.name==="Shift")$.stateStack.push(o.arg),$.valueStack.push(new zt(s,this.current.value)),this.nextToken(),n={action:o,stateStackDiff:[$.stateStack[$.stateStack.length-1]],valueStackDiff:[$.valueStack[$.valueStack.length-1]]};else if(o.name==="Reduce"){let u=$.rules[o.arg],i=u.expansion.length,a=$.stateStack.splice(-i,i),r=$.valueStack.splice(-i,i);n={action:o,stateStackDiff:a,valueStackDiff:r},this.current=new zt(u.origin,r)}else o.name==="Goto"?($.stateStack.push(o.arg),$.valueStack.push(this.current),this.current=$.tokens[this.tokenPtr],n={action:o,stateStackDiff:[$.stateStack[$.stateStack.length-1]],valueStackDiff:[$.valueStack[$.valueStack.length-1]]}):(this.done=!0,n={action:o,stateStackDiff:[],valueStackDiff:[]});return mt(pt({},n),{actionSource:{stateId:t,symbol:s},currentStateId:$.stateStack[$.stateStack.length-1],next:this.current})}nextToken(){if(this.tokenPtr++,this.tokenPtr>=$.tokens.length)throw new ae(J.TOKEN_LIST_INDEX_OUT_OF_RANGE);return this.current=$.tokens[this.tokenPtr],this.current}}function $s(e){return new Promise(function(t,s){let n=!1,o=document.querySelector('script[src="'+e+'"]');if(!o)o=document.createElement("script"),o.type="text/javascript",o.async=!0,o.src=e,n=!0;else if(o.hasAttribute("data-loaded")){t(o);return}o.addEventListener("error",s),o.addEventListener("abort",s),o.addEventListener("load",function(){o.setAttribute("data-loaded",!0),t(o)}),n&&document.head.appendChild(o)})}class at extends Error{constructor(s,n){super(s);S(this,"extra");this.extra=n}}let qe;async function Rs(e){return await $s("/pyodide/pyodide.js"),qe=await window.loadPyodide({indexURL:"/pyodide"}),e==null||e.call(this,"Pyodide loaded. Installing micropip..."),await qe.loadPackage("micropip"),await qe.runPythonAsync("import micropip"),e==null||e.call(this,"Micropip installed."),qe}function As(){if(qe===void 0)throw new at("PyodideNotLoaded");return qe}async function Is(e){e("Loading Pyodide...");const t=await Rs(e);if(t===void 0)throw new at("PyodideLoadFailed");e("Installing Lark..."),await t.runPythonAsync("await micropip.install('lark')"),await t.runPythonAsync("from lark import Lark"),await t.runPythonAsync("import json"),e("Finish loading Lark.")}let $t;function Cs(e,t,s,n){try{const o=As(),u=[],i=[];o.globals.set("grammar",t),o.globals.set("text",s);let a=`parser = Lark(grammar, parser="lalr", lexer="basic", keep_all_tokens=True)
ruleList = []
for rule in parser.rules:
    ruleList.append(json.dumps(rule.serialize()))
def serialize_token(token):
    d = {"type":token.type,"value":token.value, "start_pos": token.start_pos,
    "line":token.line, "column": token.column, "end_line": token.end_line,
    "end_column":token.end_column, "end_pos": token.end_pos, "__type__": "Token"}
    return json.dumps(d)
tokenGenerator = parser.lex(text)
tokenList = []
for token in tokenGenerator:
    tokenList.append(serialize_token(token))`;o.runPython(a);let r=o.globals.get("ruleList");for(let f=0;f<r.length;f++){let g=rt.deserialize(JSON.parse(r.get(f)));u.push(g)}r.destroy();let d=o.globals.get("tokenList");for(let f=0;f<d.length;f++){let g=je.deserialize(JSON.parse(d.get(f)));i.push(g)}d.destroy(),a=`del parser
del ruleList
del tokenGenerator
del tokenList`,o.runPython(a),$t=new Es(e,u,i,n)}catch(o){throw new at("InitParserError",o instanceof Error?o.message:void 0)}}function Je(){if($t===void 0)throw new at("ParserNotInited");return $t}const Ps={options:{type:Array,default:[]},disable:{type:Boolean,default:!1},modelValue:{type:String,default:""}},xs=ie({name:"GRadioGroup",props:Ps,setup(e,t){const s=L(0),n=e.options.indexOf(e.modelValue);n!==-1&&(s.value=n);function o(u){s.value=u,t.emit("update:modelValue",e.options[u])}return e.options.length>0&&o(s.value),{activeRadioIndex:s,updateValue:o}}}),Ms={ref:"radioGroupRef"},Os=["onClick"];function Ns(e,t,s,n,o,u){return h(),p("div",Ms,[(h(!0),p(M,null,Z(e.options,(i,a)=>(h(),p("button",{class:j(["g-radio-button",e.disable?"disable":"",a===e.activeRadioIndex?"active":""]),onClick:r=>e.disable?void 0:e.updateValue(a)},T(i),11,Os))),256))],512)}var zs=ce(xs,[["render",Ns],["__scopeId","data-v-0fcadbec"]]);const Ds=ie({props:{type:{type:String,default:"default"}},setup(){}});function Bs(e,t,s,n,o,u){return h(),p("button",{class:j(["__g-button","__g-button-type-"+e.type])},[nt(e.$slots,"default")],2)}var ke=ce(Ds,[["render",Bs]]);const Gs={placeholder:{type:String,default:""},resize:{type:String,default:"none"},modelValue:{type:String,default:""},rows:{type:Number,defalut:10}},Hs=ie({props:Gs,setup(e,t){L();const s=he(()=>({resize:e.resize}));function n(o){const u=o.target.value;t.emit("update:modelValue",u)}return{textareaStyle:s,handleTextareaInput:n}}}),Fs=["placeholder","rows"];function Us(e,t,s,n,o,u){return h(),p("textarea",{ref:"textarea",class:"g-textarea",placeholder:e.placeholder,style:Ae(e.textareaStyle),rows:e.rows,onInput:t[0]||(t[0]=(...i)=>e.handleTextareaInput&&e.handleTextareaInput(...i))},null,44,Fs)}var Vs=ce(Hs,[["render",Us],["__scopeId","data-v-19beb715"]]);const Ws={direction:{type:String,required:!0},size:{type:Number,default:16}},Ys=ie({props:Ws,setup(e,t){const s=L(),n=L();return He(()=>{s.value.style.height=n.value.offsetHeight/2+"px"}),he(()=>({borderWidth:e.size})),{arrow:s,arrowInner:n}}}),qs={class:"arrow",ref:"arrow"},Xs={class:"arrow-inner",ref:"arrowInner"};function js(e,t,s,n,o,u){return h(),p("div",qs,[l("div",Xs,null,512)],512)}var Ks=ce(Ys,[["render",js],["__scopeId","data-v-91ef504e"]]);const Zs={title:String,content:String,type:{type:String,default:"primary"},verticalOffset:{type:Number,default:60},duration:{type:Number,default:4e3},id:{type:String,required:!0}},Qs=ie({props:Zs,setup(e,t){const s=L(),n=L(!1);let o;function u(){o=window.setTimeout(()=>{n.value=!1},e.duration)}function i(){clearTimeout(o),o=void 0}return He(()=>{var a;(a=s.value)==null||a.addEventListener("transitionend",()=>{n.value===!1&&t.emit("destroy",e.id)}),u(),setTimeout(()=>{n.value=!0},0)}),{active:n,notification:s,startTimer:u,stopTimer:i}}}),Js=["id"],en={class:"notification-title"},tn={class:"notification-content"};function sn(e,t,s,n,o,u){return h(),p("div",{id:e.id,class:j(["g-notification",e.active?"notification-active":""]),ref:"notification",style:Ae({top:e.verticalOffset+"px"}),onMouseenter:t[0]||(t[0]=(...i)=>e.stopTimer&&e.stopTimer(...i)),onMouseleave:t[1]||(t[1]=(...i)=>e.startTimer&&e.startTimer(...i))},[l("div",{class:j(["notification-type-"+e.type,"notification-inner"])},[l("div",en,T(e.title),1),l("div",tn,T(e.content),1)],2)],46,Js)}var nn=ce(Qs,[["render",sn],["__scopeId","data-v-07aa7a74"]]);const Be=[],Gt=16,on=60;let an=1;function yt(e){let t=on;Be.forEach(a=>{var r;t+=(((r=a.el)==null?void 0:r.offsetHeight)||0)+Gt});const s=document.createElement("div");function n(a){var f;let r=Be.findIndex(g=>{var I;return((I=g.component)==null?void 0:I.props.id)===a});if(r===-1)return;let c=((f=Be[r].el)==null?void 0:f.offsetHeight)||0;Be.splice(r,1);for(let g=r;g<Be.length;g++){let I=Number.parseInt(Be[g].el.style.top,10)-c-Gt;Be[g].component.props.verticalOffset=I}Ot(null,s)}let o=document.body;const u={title:e.title,content:e.content,type:e.type,verticalOffset:t,id:`g-notification_${an++}`,onDestroy:n},i=X(nn,u);Ot(i,s),o.appendChild(s.firstElementChild),Be.push(i)}const ln=ie({props:{activeText:{type:String,default:""},inactiveText:{type:String,default:""},modelValue:{type:Boolean},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(e,t){function s(){e.disabled||(t.emit("update:modelValue",!e.modelValue),t.emit("change",e.modelValue))}return{switchChange:s}}}),rn={key:0,class:"__g-switch-text __g-switch-text-l"},un={key:1,class:"__g-switch-text __g-switch-text-r"};function cn(e,t,s,n,o,u){return h(),p("div",{class:j(["__g-switch",e.disabled?"__g-switch-disabled":""]),onClick:t[0]||(t[0]=i=>e.switchChange())},[e.inactiveText?(h(),p("span",rn,T(e.inactiveText),1)):V("",!0),l("span",{class:j(["__g-switch-core",e.modelValue?"__g-switch-core-active":"__g-switch-core-inactive"])},[l("div",{class:j(["__g-switch-circle",e.modelValue?"__g-switch-circle-active":"__g-switch-circle-inactive"])},null,2)],2),e.activeText?(h(),p("span",un,T(e.activeText),1)):V("",!0)],2)}var Kt=ce(ln,[["render",cn]]),dn="/assets/minus.5ab3c386.svg",Zt="/assets/switcher.7fb22669.svg",hn="/assets/border.93b1f158.svg",fn="/assets/pushpin.9cdf606a.svg";const Rt=new Map;let ot=0;function pn(e){const t=Symbol();return Rt.set(t,e),ot++,[t,ot]}function mn(e){Rt.delete(e)}window.addEventListener("resize",_n);function _n(){Rt.forEach(e=>e.exposed.avoidOutOfBound())}function gn(e){return e===ot?e:(ot++,ot)}const vn={class:"__g-window-bar-title"},yn={width:"16",height:"16",src:dn,alt:"min"},wn={width:"16",height:"16",src:Zt,alt:"min"},Sn={width:"16",height:"16",src:hn,alt:"max"},Ln={width:"16",height:"16",src:Zt,alt:"max"},kn=ie({name:"Window",props:{title:{type:String,required:!0},defaultStyle:{type:Object},position:{type:String,default:"fixed"}},setup(e,{expose:t}){const s=e,n=L(),o=L(),u=L(),i=L(),a=L(),r=L(),d=L(),c=L(),f=L(),g=L(),I=L(),O=L(),P=L(),G=L(),W=300,ee=hs(),[pe,oe]=pn(ee);He(()=>{var K,k,R,A,Y,F,se,m,b,v,E,y,C;(K=n.value)==null||K.addEventListener("mousedown",Pe),(k=o.value)==null||k.addEventListener("mousedown",Oe),(R=i.value)==null||R.addEventListener("mousedown",w=>w.stopPropagation()),(A=a.value)==null||A.addEventListener("mousedown",w=>w.stopPropagation()),(Y=r.value)==null||Y.addEventListener("mousedown",w=>w.stopPropagation()),(F=d.value)==null||F.addEventListener("mousedown",w=>me(w,"n")),(se=c.value)==null||se.addEventListener("mousedown",w=>me(w,"s")),(m=f.value)==null||m.addEventListener("mousedown",w=>me(w,"e")),(b=g.value)==null||b.addEventListener("mousedown",w=>me(w,"w")),(v=I.value)==null||v.addEventListener("mousedown",w=>me(w,"ne")),(E=O.value)==null||E.addEventListener("mousedown",w=>me(w,"nw")),(y=P.value)==null||y.addEventListener("mousedown",w=>me(w,"se")),(C=G.value)==null||C.addEventListener("mousedown",w=>me(w,"sw"))}),We(()=>{mn(pe)});const _=ds({pinned:!0,minimized:!1,maximized:!1,left:"",top:"",width:"",height:"",zIndex:oe}),x={left:0,top:0,width:0,height:0,inited:!1},te={clickX:0,clickY:0,direction:""};function Pe(){_.pinned||(_.zIndex=gn(_.zIndex))}function we(){_.minimized=!_.minimized,_.maximized&&(_.maximized=!1),Pe()}function H(){_.maximized=!_.maximized,_.minimized&&(_.minimized=!1),_.maximized||Ee(),Pe()}function N(){let K=!_.pinned;if(!K){if(!x.inited){let k=n.value.offsetLeft,R=n.value.offsetTop;if(s.position==="fixed"){let A=n.value.offsetParent;for(;A;)k+=A.offsetLeft,R+=A.offsetTop,A=A.offsetParent}x.left=k,x.top=R,x.width=n.value.offsetWidth,x.height=n.value.offsetHeight}_.left=x.left+"px",_.top=x.top+"px",_.width=x.width+"px",_.height=x.height+"px"}_.pinned=K,Te(()=>{Ee()}),Pe()}function ue(K){te.clickX=K.pageX,te.clickY=K.pageY,x.inited=!0,x.left=n.value.offsetLeft,x.top=n.value.offsetTop,x.width=n.value.offsetWidth,_.minimized||(x.height=n.value.offsetHeight)}function xe(){x.left=n.value.offsetLeft,x.top=n.value.offsetTop,x.width=n.value.offsetWidth,_.minimized||(x.height=n.value.offsetHeight),document.removeEventListener("mousemove",Ne),document.removeEventListener("mousemove",Ge),document.removeEventListener("mouseup",xe)}function Oe(K){_.pinned||_.maximized||(ue(K),document.addEventListener("mousemove",Ne),document.addEventListener("mouseup",xe))}function Ne(K){const[k,R]=[K.pageX-te.clickX,K.pageY-te.clickY];_.left=(x.left+k<0?0:x.left+k)+"px",_.top=(x.top+R<0?0:x.top+R)+"px"}function me(K,k){_.pinned||(K.preventDefault(),ue(K),te.direction=k,document.addEventListener("mousemove",Ge),document.addEventListener("mouseup",xe))}function Ge(K){if(te.direction==="")return;const[k,R]=[K.pageX-te.clickX,K.pageY-te.clickY],A=()=>{x.height-R<W||(_.height=x.height-R+"px",_.top=x.top+R+"px")},Y=()=>{x.height+R<W||(_.height=x.height+R+"px")},F=()=>{x.width-k<W||(_.width=x.width-k+"px",_.left=x.left+k+"px")},se=()=>{x.width+k<W||(_.width=x.width+k+"px")};te.direction==="e"?se():te.direction==="ne"?(A(),se()):te.direction==="nw"?(A(),F()):te.direction==="n"?A():te.direction==="se"?(Y(),se()):te.direction==="sw"?(Y(),F()):te.direction==="s"?Y():te.direction==="w"&&F()}function Ee(){_.pinned||_.maximized||s.position==="absolute"||(x.top>=window.innerHeight-200&&(x.top=window.innerHeight-200),x.left>=window.innerHeight-200&&(x.left=window.innerHeight-200),_.top=x.top+"px",_.left=x.left+"px")}return t({avoidOutOfBound:Ee}),(K,k)=>(h(),p("div",{class:"__g-window",ref_key:"windowRef",ref:n,style:Ae(_.maximized?{top:0,bottom:0,left:0,right:0,position:"fixed",zIndex:_.zIndex}:_.pinned?_.minimized?mt(pt({},e.defaultStyle),{height:"28px"}):e.defaultStyle:{width:_.width,height:_.minimized?"28px":_.height,top:_.top,left:_.left,position:e.position,zIndex:_.zIndex,boxShadow:"0 0 8px gray"})},[l("div",{class:"__g-window-bar",ref_key:"barRef",ref:o},[l("span",vn,T(e.title),1),l("span",{class:"__g-window-bar-button",ref_key:"minimizeBtn",ref:i,onClick:k[0]||(k[0]=R=>we())},[q(l("img",yn,null,512),[[Q,!_.minimized]]),q(l("img",wn,null,512),[[Q,_.minimized]])],512),l("span",{class:"__g-window-bar-button",ref_key:"maximizeBtn",ref:a,onClick:k[1]||(k[1]=R=>H())},[q(l("img",Sn,null,512),[[Q,!_.maximized]]),q(l("img",Ln,null,512),[[Q,_.maximized]])],512),l("span",{class:"__g-window-bar-button",ref_key:"pinBtn",ref:r,onClick:k[2]||(k[2]=R=>N())},[q(l("img",{width:"16",height:"16",src:fn,alt:"pin",style:Ae(_.pinned?{}:{transform:"rotate(-45deg)"})},null,4),[[Q,!_.maximized]])],512)],512),l("div",{class:"__g-window-inner",ref_key:"innerRef",ref:u},[nt(K.$slots,"default")],512),q(l("div",{class:"__g-window-resize-area-n",ref_key:"resizeAreaN",ref:d},null,512),[[Q,!_.pinned&&!_.minimized&&!_.maximized]]),q(l("div",{class:"__g-window-resize-area-s",ref_key:"resizeAreaS",ref:c},null,512),[[Q,!_.pinned&&!_.minimized&&!_.maximized]]),q(l("div",{class:"__g-window-resize-area-e",ref_key:"resizeAreaE",ref:f,style:Ae(_.minimized?{top:0,bottom:0}:{})},null,4),[[Q,!_.pinned&&!_.maximized]]),q(l("div",{class:"__g-window-resize-area-w",ref_key:"resizeAreaW",ref:g,style:Ae(_.minimized?{top:0,bottom:0}:{})},null,4),[[Q,!_.pinned&&!_.maximized]]),q(l("div",{class:"__g-window-resize-area-ne",ref_key:"resizeAreaNE",ref:I},null,512),[[Q,!_.pinned&&!_.minimized&&!_.maximized]]),q(l("div",{class:"__g-window-resize-area-nw",ref_key:"resizeAreaNW",ref:O},null,512),[[Q,!_.pinned&&!_.minimized&&!_.maximized]]),q(l("div",{class:"__g-window-resize-area-se",ref_key:"resizeAreaSE",ref:P},null,512),[[Q,!_.pinned&&!_.minimized&&!_.maximized]]),q(l("div",{class:"__g-window-resize-area-sw",ref_key:"resizeAreaSW",ref:G},null,512),[[Q,!_.pinned&&!_.minimized&&!_.maximized]])],4))}});const bn={class:"__g-loading-mask"},Tn={class:"__g-loading"},En=l("svg",{class:"__g-loading-svg"},[l("circle",{class:"__g-loading-circle",cx:"22",cy:"22",r:"20"})],-1),$n={class:"__g-loading-text"},Rn={key:1},Qt=ie({name:"Loading",props:{text:null},setup(e){return(t,s)=>(h(),p("div",bn,[l("div",Tn,[En,l("div",$n,[Array.isArray(e.text)?(h(!0),p(M,{key:0},Z(e.text,n=>(h(),p("div",null,T(n),1))),256)):(h(),p("div",Rn,T(e.text),1))])])]))}});const An=ie({props:{title:{type:String},visible:{type:Boolean,default:!1},width:{type:String}},emits:["update:visible","close"],setup(e,t){function s(){t.emit("update:visible",!1),t.emit("close")}return{close:s}}}),In={class:"__g-modal-mask"},Cn={class:"__g-modal-wrap"},Pn={class:"__g-modal-header"},xn=l("i",{class:"bi bi-x"},null,-1),Mn=[xn],On={key:1,class:"__g-modal-title"},Nn={class:"__g-modal-body"},zn={key:0,class:"__g-modal-footer"};function Dn(e,t,s,n,o,u){return h(),p(M,null,[q(l("div",In,null,512),[[Q,e.visible]]),q(l("div",Cn,[l("div",{class:"__g-modal",style:Ae({width:e.width})},[l("div",Pn,[l("button",{type:"button",class:"__g-modal-close",onClick:t[0]||(t[0]=i=>e.close())},Mn),e.$slots.header?nt(e.$slots,"header",{key:0}):(h(),p("span",On,T(e.title),1))]),l("div",Nn,[nt(e.$slots,"default")]),e.$slots.footer?(h(),p("div",zn,[nt(e.$slots,"footer")])):V("",!0)],4)],512),[[Q,e.visible]])],64)}var Bn=ce(An,[["render",Dn]]);const Gn={rule:{type:Object,required:!0},index:{type:Number}},Hn=ie({props:Gn,setup(e,t){}}),Fn=e=>(Ie("data-v-446ab70f"),e=e(),Ce(),e),Un={class:"rule-line"},Vn={key:0,class:"rule-index"},Wn={class:"rule-item"},Yn={class:"rule-symbol non-terminal"},qn=Fn(()=>l("span",{class:"rule-symbol rule-arrow"},"\u2192",-1));function Xn(e,t,s,n,o,u){var i;return h(),p("div",Un,[e.index!==void 0?(h(),p("span",Vn,"("+T(e.index)+")",1)):V("",!0),l("div",Wn,[l("span",Yn,T(e.rule.origin.name),1),qn,(h(!0),p(M,null,Z((i=e.rule)==null?void 0:i.expansion,a=>(h(),p("span",{class:j(["rule-symbol",a.isTerm?"terminal":"non-terminal"])},T(a.name),3))),256))])])}var At=ce(Hn,[["render",Xn],["__scopeId","data-v-446ab70f"]]);const Ht=[["#f1f3ef","#a81e32"],["#fdf2f7","#e77671"],["#acbeac","#e94829"],["#fcf6e8","#e6653a"],["#f0ecea","#d05667"],["#fef5f5","#962832"],["#f4f8e9","#e31b13"],["#f2f4fa","#22406a"],["#a1d4bd","#382c77"],["#ccccb8","#004ea2"],["#e6efc3","#137fa0"],["#fdece9","#a1d4bd"],["#f2f0eb","#758e61"],["#faf8d0","#62be9d"],["#faf6b7","#47b897"],["#eff8fe","#a8cd34"],["#fcefe8","#21a675"],["#ffed95","#c36625"],["#fdf8f0","#eab946"],["#f5fbfe","#4e606c"],["#bacac6","#3f545b"],["#c8d0d2","#655756"],["#f9f9fb","#382f41"],["#dedcdf","#370708"],["#dae5f5","#874154"],["#efc5b4","#564163"],["#eef0f1","#c1a1ca"],["#fff8d9","#5c1028"],["#fce1d6","#aaa1ce"]],jn=["#f5f5f5","#d3d3d3"],Ft=new Map;let Ut=0;function Kn(e){let t=Ft.get(e.type);return t!==void 0||(t=Ht[Ut%Ht.length],Ut++,Ft.set(e.type,t)),t}const Zn={tokenLine:{type:Array,required:!0,default:[]},lineNo:{type:Number,required:!0},wrap:{type:Boolean,default:!1},tokenContent:{type:Boolean,default:!0}},Qn=ie({props:Zn,setup(e,t){const s=L([]);return e.tokenLine.forEach(n=>{let o=Kn(n),u={token:n,active:!0,color:o};s.value.push(u)}),{tagList:s,inactiveColor:jn}}}),Jt=e=>(Ie("data-v-abc11f12"),e=e(),Ce(),e),Jn={class:"token-line-no"},eo=Jt(()=>l("span",null,"(",-1)),to={class:"non-terminal"},so=Jt(()=>l("span",null,")",-1));function no(e,t,s,n,o,u){return h(),p("div",{class:j(["token-line",[e.wrap?"token-line-wrap":""]])},[l("span",Jn,T(e.lineNo),1),l("div",{class:j(["token-line-item",[e.wrap?"token-line-item-wrap":""]])},[(h(!0),p(M,null,Z(e.tagList,i=>(h(),p("div",{class:"token-tag",style:Ae(i.active?{backgroundColor:i.color[0],color:i.color[1],borderColor:i.color[1]}:{backgroundColor:e.inactiveColor[0],color:e.inactiveColor[1],borderColor:e.inactiveColor[1]})},[l("span",{class:j(i.token.symbol.isTerm?"terminal":"non-terminal")},T(i.token.symbol.name),3),e.tokenContent&&i.token.symbol.name!==i.token.value?(h(),p(M,{key:0},[eo,l("span",to,T(i.token.value),1),so],64)):V("",!0)],4))),256))],2)],2)}var oo=ce(Qn,[["render",no],["__scopeId","data-v-abc11f12"]]);const lt={};let ao=0;const re={async publish(e,t,...s){console.log("PUBLISH: "+e+"/"+t);const n=lt[e];if(!n)return;const o=n[t];if(!o)return;let u=[];for(let i in o)u.push(o[i](...s));return Promise.all(u)},subscribe(e,t,s){lt[e]||(lt[e]={});const n=lt[e];n[t]||(n[t]={});const o=n[t],u=ao++;o[u]=s;function i(){delete o[u],Object.keys(o).length===0&&delete n[t]}return i}};const io=ie({components:{GRadioButtonGroup:zs,GButton:ke,GTextarea:Vs,GArrow:Ks,GSwitch:Kt,RuleLine:At,TokenLine:oo},setup(){const{t:e}=Ze({useScope:"global"}),t=fs(),s=ps(),n=Qe(),o=L(""),u=L(""),i=["LR0","LR1","LR1_LALR1"],a=L("LR0"),r=L(!0),d=L([]),c=L([]),f=L(!1);ms(a,oe=>{n.algorithm=oe,t.replace({query:{a:n.algorithm}})}),i.includes(s.query.a)&&(a.value=s.query.a);function g(){Cs(a.value,o.value,u.value,r.value);const oe=Je();f.value=!0,d.value=oe.store.rules,c.value=oe.store.tokens,O(),n.showControlPanel=!0,n.showAutomaton=!0,Te(()=>{var _;(_=document.getElementById("automaton"))==null||_.scrollIntoView({behavior:"smooth"})})}const I=L([]);function O(){let oe=1,_=[];c.value.forEach(x=>{x.line>oe&&(I.value.push(_),_=[],oe++),_.push(x)}),_.length>0&&I.value.push(_)}const P=L(!1);function G(){P.value=!P.value}const W=L(!0);function ee(){o.value="",u.value="",d.value=[],c.value=[],I.value=[],f.value=!1,n.$reset(),n.algorithm=a.value}const pe=[re.subscribe("lr","InputPanelReset",ee)];return We(()=>pe.forEach(oe=>oe())),{t:e,parse:g,replaceTerminalName:r,grammar:o,text:u,algos:i,algorithm:a,ruleList:d,tokenLineList:I,started:f,tokenLineWrap:P,changeTokenLineWrap:G,showTokenContent:W}}}),lo=e=>(Ie("data-v-8a01c8f2"),e=e(),Ce(),e),ro={class:"panel-container"},uo={class:"control-panel"},co=["href"],ho=lo(()=>l("i",{class:"bi bi-question-circle",style:{color:"gray","font-size":"12px","margin-left":"4px"}},null,-1)),fo=[ho],po={key:0,class:"input-panel"},mo={class:"grammar-input panel-item"},_o={class:"text-input panel-item"},go={key:1,class:"token-rule-panel"},vo={class:"rule-panel panel-item"},yo={class:"token-panel panel-item"},wo={class:"token-line-check"};function So(e,t,s,n,o,u){const i=ne("GRadioButtonGroup"),a=ne("GSwitch"),r=ne("GButton"),d=ne("GTextarea"),c=ne("RuleLine"),f=ne("TokenLine");return h(),p("div",ro,[l("div",uo,[e.started?V("",!0):(h(),p(M,{key:0},[X(i,{modelValue:e.algorithm,"onUpdate:modelValue":t[0]||(t[0]=g=>e.algorithm=g),options:e.algos},null,8,["modelValue","options"]),l("div",null,[X(a,{modelValue:e.replaceTerminalName,"onUpdate:modelValue":t[1]||(t[1]=g=>e.replaceTerminalName=g),"active-text":e.t("LR.InputPanel.NameCharacter"),"inactive-text":e.t("LR.InputPanel.KeepCharacter")},null,8,["modelValue","active-text","inactive-text"]),l("a",{href:e.t("GuideURLs.NameCharacter"),target:"_blank"},fo,8,co)]),X(r,{onClick:t[2]||(t[2]=g=>e.parse()),type:"success"},{default:de(()=>[ve(T(e.t("LR.InputPanel.ParseButton")),1)]),_:1})],64))]),e.started?V("",!0):(h(),p("div",po,[l("div",mo,[X(d,{class:"input-textarea",resize:"none",modelValue:e.grammar,"onUpdate:modelValue":t[3]||(t[3]=g=>e.grammar=g),placeholder:e.t("LR.InputPanel.GrammarPlaceholder")},null,8,["modelValue","placeholder"])]),l("div",_o,[X(d,{class:"input-textarea",resize:"none",modelValue:e.text,"onUpdate:modelValue":t[4]||(t[4]=g=>e.text=g),placeholder:e.t("LR.InputPanel.TextPlaceholder")},null,8,["modelValue","placeholder"])])])),e.started?(h(),p("div",go,[l("div",vo,[(h(!0),p(M,null,Z(e.ruleList,(g,I)=>(h(),ye(c,{class:"rule-line",rule:g,index:I},null,8,["rule","index"]))),256))]),l("div",yo,[l("div",wo,[q(l("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=g=>e.tokenLineWrap=g)},null,512),[[Nt,e.tokenLineWrap]]),l("label",null,T(e.t("LR.InputPanel.WordWrap")),1),q(l("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=g=>e.showTokenContent=g)},null,512),[[Nt,e.showTokenContent]]),l("label",null,T(e.t("LR.InputPanel.TokenContent")),1)]),l("div",{class:j(["token-line-container",[e.tokenLineWrap?"token-line-container-wrap":""]])},[(h(!0),p(M,null,Z(e.tokenLineList,(g,I)=>(h(),ye(f,{class:"token-line","token-line":g,lineNo:I+1,wrap:e.tokenLineWrap,"token-content":e.showTokenContent},null,8,["token-line","lineNo","wrap","token-content"]))),256))],2)])])):V("",!0)])}var Lo=ce(io,[["render",So],["__scopeId","data-v-8a01c8f2"]]);const es=e=>(Ie("data-v-280e472f"),e=e(),Ce(),e),ko={class:"control-panel"},bo={class:"control-panel-group"},To=es(()=>l("span",{class:"non-terminal"},"I",-1)),Eo={class:"non-terminal"},$o={class:"control-panel-group"},Ro=["href"],Ao=es(()=>l("i",{class:"bi bi-question-circle",style:{color:"gray","font-size":"12px"}},null,-1)),Io=[Ao],Co={key:2,class:"control-panel-group"},Po={key:3},xo=ie({name:"control-panel",setup(e){const{t}=Ze({useScope:"global"}),s=Qe(),n=he(()=>s.manual);function o(){s.manual=!s.manual}const u=Je(),i=he(()=>s.currentStateId),a=he(()=>s.algorithm),r=L(0),d=L(0),c=he(()=>!s.showClosureModal&&(n.value||!s.stateFlags[i.value].closureDone&&r.value===0)),f=he(()=>{const H=s.stateFlags[i.value];return!s.showClosureModal&&(n.value||H.closureDone&&!H.appended&&r.value===0)}),g=he(()=>!n.value&&r.value===2&&!s.showClosureModal),I=he(()=>!s.showClosureModal&&!n.value),O=he(()=>s.showClosureModal);async function P(H=!1){const N=u.automaton.CalcStateClosure(i.value,a.value);(a.value==="LR1"||a.value==="LR1_LALR1")&&u.automaton.MergeLookaheads(i.value),s.stateFlags[i.value].closureDone=!0,H&&re.publish("lr","InitClosureStep",N),await re.publish("lr","State"+i.value+"Closure",N.state)}function G(){re.publish("lr","ClosureStep")}async function W(){const H=u.automaton.AppendStates(i.value);await re.publish("lr","AutomatonAppendStates",H),n.value||(s.stateFlags[i.value].active=!1,ee()?s.stateFlags[i.value].active=!0:a.value==="LR0"||a.value==="LR1"?r.value=2:r.value=1)}function ee(){let H=i.value+1;for(;;){if(H>=u.automaton.states.length)return!1;let N=u.automaton.states[H];if(N===void 0){++H;continue}if(!(N.closureDone&&N.appended))break;H++}return s.currentStateId=H,!0}async function pe(){s.automatonLoading=!0,setTimeout(async()=>{for(;r.value===0;){const H=s.stateFlags[i.value];H.closureDone||await P(),H.appended||await W()}r.value===1&&await oe(),s.automatonLoading=!1})}async function oe(){const H=u.automaton.mergeLr1();await re.publish("lr","AutomatonMergeLr1States",H),r.value=2}function _(){u.parseTable.calc(),d.value=1,s.showParseTable=!0,Te(()=>{var H;(H=document.getElementById("parsetable"))==null||H.scrollIntoView({behavior:"smooth"})})}function x(){d.value=2,s.showParseTree=!0,Te(()=>{var H;(H=document.getElementById("parsetree"))==null||H.scrollIntoView({behavior:"smooth"})})}function te(){const H=u.parseByStep();re.publish("lr","ParseTreeStep",H),re.publish("lr","ParseTableHighlight",H.actionSource),re.publish("lr","AutomatonStatesPath",H),u.done&&(d.value=3)}function Pe(){for(;!u.done;)te()}function we(){re.publish("lr","InputPanelReset")}return(H,N)=>(h(),p("div",ko,[d.value===0?(h(),p(M,{key:0},[r.value===0?(h(),p(M,{key:0},[l("div",bo,[l("div",null,[ve(T(D(t)("LR.ControlPanel.CurrentState"))+" ",1),To,l("sub",Eo,T(D(i)),1)]),q(X(D(ke),{type:"success",onClick:N[0]||(N[0]=ue=>P(!0))},{default:de(()=>[ve(T(D(t)("LR.ControlPanel.StepClosure")),1)]),_:1},512),[[Q,D(c)]]),q(X(D(ke),{type:"success",onClick:N[1]||(N[1]=ue=>P())},{default:de(()=>[ve(T(D(t)("LR.ControlPanel.CalcualteClosure")),1)]),_:1},512),[[Q,D(c)]]),q(X(D(ke),{type:"success",onClick:N[2]||(N[2]=ue=>W())},{default:de(()=>[ve(T(D(t)("LR.ControlPanel.AppendStates")),1)]),_:1},512),[[Q,D(f)]]),q(X(D(ke),{type:"info",onClick:N[3]||(N[3]=ue=>pe())},{default:de(()=>[ve(T(D(t)("LR.ControlPanel.Skip")),1)]),_:1},512),[[Q,D(I)]]),q(X(D(ke),{type:"success",onClick:N[4]||(N[4]=ue=>G())},{default:de(()=>[ve(T(D(t)("LR.ControlPanel.StepClosureStep")),1)]),_:1},512),[[Q,D(O)]])]),q(l("div",$o,[l("span",null,[ve(T(D(t)("LR.ControlPanel.ManualMode"))+" ",1),l("a",{href:D(t)("GuideURLs.ManualMode"),target:"_blank"},Io,8,Ro)]),X(D(Kt),{"model-value":D(n),onChange:o,disabled:D(n)},null,8,["model-value","disabled"])],512),[[Q,!D(s).showClosureModal]])],64)):V("",!0),r.value===1?(h(),ye(D(ke),{key:1,type:"info",onClick:N[5]||(N[5]=ue=>oe())},{default:de(()=>[ve(T(D(t)("LR.ControlPanel.MergeLR1")),1)]),_:1})):V("",!0),r.value===2?q((h(),ye(D(ke),{key:2,type:"info",onClick:N[6]||(N[6]=ue=>_())},{default:de(()=>[ve(T(D(t)("LR.ControlPanel.CalculateParseTable")),1)]),_:1},512)),[[Q,D(g)]]):V("",!0)],64)):V("",!0),d.value===1?(h(),ye(D(ke),{key:1,type:"info",onClick:N[7]||(N[7]=ue=>x())},{default:de(()=>[ve(T(D(t)("LR.ControlPanel.StartParse")),1)]),_:1})):V("",!0),d.value===2?(h(),p("div",Co,[X(D(ke),{type:"success",onClick:N[8]||(N[8]=ue=>te())},{default:de(()=>[ve(T(D(t)("LR.ControlPanel.ParseStep")),1)]),_:1}),X(D(ke),{type:"info",onClick:N[9]||(N[9]=ue=>Pe())},{default:de(()=>[ve(T(D(t)("LR.ControlPanel.Skip")),1)]),_:1})])):V("",!0),d.value===3?(h(),p("span",Po,T(D(t)("LR.ControlPanel.Finish")),1)):V("",!0),X(D(ke),{onClick:N[10]||(N[10]=ue=>we()),type:"error"},{default:de(()=>[ve(T(D(t)("LR.ControlPanel.Reset")),1)]),_:1})]))}});var Mo=ce(xo,[["__scopeId","data-v-280e472f"]]);const Oo=ie({props:{lrItem:{type:Object,required:!0}},setup(){}}),ts=e=>(Ie("data-v-42889209"),e=e(),Ce(),e),No={class:"lr-item"},zo={class:"lr-item-symbol non-terminal"},Do=ts(()=>l("span",{class:"lr-item-arrow"},"\u2192",-1)),Bo={key:0,class:"lr-item-dot"},Go={key:0,class:"lr-item-dot"},Ho=ts(()=>l("span",{class:"lr-item-comma"},",",-1)),Fo={class:"lr-item-symbol terminal"},Uo={key:0,class:"lr-item-lookahead-sep"};function Vo(e,t,s,n,o,u){return h(),p("div",No,[l("span",zo,T(e.lrItem.rule.origin.name),1),Do,e.lrItem.index===0?(h(),p("span",Bo,"\u25CF")):V("",!0),(h(!0),p(M,null,Z(e.lrItem.rule.expansion,(i,a)=>(h(),p(M,null,[l("span",{class:j(["lr-item-symbol",i.isTerm?"terminal":"non-terminal"])},T(i.name),3),a+1===e.lrItem.index?(h(),p("span",Go,"\u25CF")):V("",!0)],64))),256)),e.lrItem.lookahead.size>0?(h(),p(M,{key:1},[Ho,(h(!0),p(M,null,Z(e.lrItem.lookahead,(i,a)=>(h(),p(M,null,[l("span",Fo,T(i.name),1),a!==e.lrItem.lookahead.size-1?(h(),p("span",Uo,"/")):V("",!0)],64))),256))],64)):V("",!0)])}var ss=ce(Oo,[["render",Vo],["__scopeId","data-v-42889209"]]);const Wo=ie({props:{state:{type:Object,required:!0},stateItemData:{type:Object,required:!0}},emits:["updateState"],components:{LrItemComponent:ss},setup(e,t){const s=Qe();s.stateFlags[e.state.id].closureDone=e.state.closureDone,s.stateFlags[e.state.id].appended=e.state.appended;const n=L(),o=L([]),u=L([]),i=he(()=>s.stateFlags[e.state.id].active),a=he(()=>s.stateFlags[e.state.id].appended),r=L(-1);e.state.kernel.forEach(G=>{o.value.push(G)});const d=L(0);function c(G){o.value=[...G.kernel],u.value=[...G.closure],u.value.splice(0,o.value.length),d.value++}function f(G){o.value=[...G.kernel],u.value=[...G.closure],u.value.splice(0,o.value.length),Te(()=>{t.emit("updateState",e.state.id,!0)})}const g=L(0),I=L([]);async function O(G){var W;I.value.push(G),g.value++,(W=n.value)==null||W.classList.add("state-merged"),await Te(),t.emit("updateState",e.state.id,!1)}const P=[re.subscribe("lr","State"+e.state.id+"MergeLookaheads",c),re.subscribe("lr","State"+e.state.id+"Closure",f),re.subscribe("lr","State"+e.state.id+"MergeLr1",O)];return We(()=>{P.forEach(G=>G())}),{stateContainerRef:n,kernel:o,closureExceptKernel:u,currentItem:r,active:i,done:a,updateClosureKey:d,updateStateKey:g,mergeFromList:I}}}),et=e=>(Ie("data-v-6f810d46"),e=e(),Ce(),e),Yo={class:"state-id"},qo=et(()=>l("span",{class:"non-terminal"},"I",-1)),Xo={class:"terminal"},jo=et(()=>l("span",null,"\xA0(",-1)),Ko=et(()=>l("span",{class:"non-terminal"},"I",-1)),Zo={class:"terminal"},Qo={key:0},Jo=et(()=>l("span",null,")",-1)),ea={key:0,class:"state-accept"},ta=et(()=>l("svg",{class:"accept-svg",width:"10",height:"15"},[l("polyline",{class:"accept-arrow",points:"5,0 5,12 0,7 5,12 10,7"})],-1)),sa=et(()=>l("div",{class:"terminal",style:{"line-height":"12px"}},"accept",-1)),na=[ta,sa];function oa(e,t,s,n,o,u){const i=ne("LrItemComponent");return h(),p("div",{class:j(["state-container",[e.active?"state-active":"",e.done?"state-done":"",e.stateItemData.highlight==="normal"?"":"state-highlight-"+e.stateItemData.highlight]]),ref:"stateContainerRef"},[l("div",Yo,[qo,l("sub",Xo,T(e.state.id),1),e.mergeFromList.length!==0?(h(),p(M,{key:0},[jo,(h(!0),p(M,null,Z(e.mergeFromList,(a,r)=>(h(),p(M,null,[Ko,l("sub",Zo,T(a),1),r!==e.mergeFromList.length-1?(h(),p("span",Qo,",")):V("",!0)],64))),256)),Jo],64)):V("",!0)]),(h(),p("div",{class:"state-kernel",key:e.updateStateKey},[(h(!0),p(M,null,Z(e.kernel,(a,r)=>(h(),ye(i,{class:j([!e.done&&r===e.currentItem?"lr-item-calcualting":"","lr-item"]),"lr-item":a},null,8,["class","lr-item"]))),256))])),(h(),p("div",{class:"state-closure",key:e.updateClosureKey+e.updateStateKey},[(h(!0),p(M,null,Z(e.closureExceptKernel,(a,r)=>(h(),ye(i,{class:j([!e.done&&r===e.currentItem-e.kernel.length?"lr-item-calcualting":"","lr-item"]),"lr-item":a},null,8,["class","lr-item"]))),256))])),e.state.end?(h(),p("div",ea,na)):V("",!0)],2)}var aa=ce(Wo,[["render",oa],["__scopeId","data-v-6f810d46"]]);const ia=ie({props:{firstSet:{type:Object,required:!0}},setup(){}}),la={class:"first-set-table"},ra={class:"first-set-row-l non-terminal"},ua={class:"first-set-row-r terminal"},ca={class:"first-set-symbol"};function da(e,t,s,n,o,u){return h(),p("div",la,[(h(!0),p(M,null,Z(e.firstSet,i=>(h(),p(M,null,[l("div",ra,T(i[0].name),1),l("div",ua,[(h(!0),p(M,null,Z(i[1],a=>(h(),p("span",ca,T(a.name),1))),256))])],64))),256))])}var ns=ce(ia,[["render",da],["__scopeId","data-v-7f9ff9f3"]]);var os=(e=>(e[e.Calculate=0]="Calculate",e[e.Next=1]="Next",e[e.Done=2]="Done",e))(os||{});const ha=ie({components:{FirstSetTable:ns,GButton:ke,GModal:Bn,LrItemComponent:ss,RuleLine:At},props:{firstSet:{type:Object,required:!0}},setup(){const{t:e}=Ze({useScope:"global"}),t=Qe(),s=he(()=>t.showClosureModal),n=Je(),o=L([]);o.value=n.store.rules.map(W=>({rule:W,highlight:!1}));const u=L([]);let i=[];const a=L([]);let r=[];const d=L(-1);function c(W){t.showClosureModal=!0,u.value=W.state.kernel.map(ee=>(i.push(ee),{item:ee,highlight:!1})),r=W.steps,r.forEach(ee=>a.value.push(ee.first)),P()}let f=L(0);function g(){f.value===0?O():f.value===1?P():G()}const I=[re.subscribe("lr","InitClosureStep",c),re.subscribe("lr","ClosureStep",g)];We(()=>I.forEach(W=>W()));function O(){if(r[d.value].step.length===0){P();return}r[d.value].step.forEach(W=>{W.existed?i.forEach((ee,pe)=>{console.log(ee.equalIncludes(W.item)),ee.equalIncludes(W.item)&&(u.value[pe].highlight=!0)}):(u.value.push({item:W.item,highlight:!0}),i.push(W.item))}),f.value=1}function P(){u.value.forEach(W=>W.highlight=!1),d.value++,d.value>=r.length?f.value=2:(f.value=0,r[d.value].step.length===0&&(f.value=1))}function G(){d.value=-1,u.value=[],i=[],a.value=[],r=[],t.showClosureModal=!1,f.value=0}return{t:e,algorithm:t.algorithm,showClosureModal:s,ruleList:o,closure:u,idx:d,firstResults:a,StepState:os,stepState:f,handleClosureStep:g,reset:G}}}),It=e=>(Ie("data-v-c1d55a22"),e=e(),Ce(),e),fa={class:"info-container"},pa={class:"rule-list"},ma={class:"panel-title"},_a={key:0,class:"first-set-panel"},ga={style:{width:"100%"}},va={class:"panel-title"},ya={key:0},wa={style:{"white-space":"nowrap"}},Sa=It(()=>l("span",null,"First(",-1)),La=It(()=>l("span",null,") = {",-1)),ka={class:"terminal first-result-item"},ba=It(()=>l("span",null,"}",-1)),Ta={class:"item-list"},Ea={class:"panel-title"},$a={style:{position:"relative"}},Ra={class:"lr-item-arrow"};function Aa(e,t,s,n,o,u){const i=ne("RuleLine"),a=ne("FirstSetTable"),r=ne("LrItemComponent"),d=ne("GButton"),c=ne("GModal");return h(),ye(c,{visible:e.showClosureModal,"onUpdate:visible":t[1]||(t[1]=f=>e.showClosureModal=f),onClose:t[2]||(t[2]=f=>e.reset()),title:e.t("LR.ClosureModal.Title"),width:"calc(100% - 256px)"},{footer:de(()=>[X(d,{onClick:t[0]||(t[0]=f=>e.reset())},{default:de(()=>[ve(T(e.t("LR.ClosureModal.Close")),1)]),_:1})]),default:de(()=>[l("div",fa,[l("div",pa,[l("div",ma,T(e.t("LR.ClosureModal.Rule")),1),(h(!0),p(M,null,Z(e.ruleList,(f,g)=>(h(),ye(i,{rule:f.rule,index:g,style:{"margin-bottom":"4px"}},null,8,["rule","index"]))),256))]),e.algorithm!=="LR0"?(h(),p("div",_a,[l("div",ga,[l("div",va,T(e.t("LR.ClosureModal.FirstSet")),1),X(a,{"first-set":e.firstSet,style:{"max-width":"100%"}},null,8,["first-set"])]),e.firstResults[e.idx]?(h(),p("div",ya,[(h(!0),p(M,null,Z(e.firstResults[e.idx],f=>(h(),p("div",wa,[Sa,(h(!0),p(M,null,Z(f.symbolString,g=>(h(),p("span",{class:j(["first-result-item",g.isTerm?"terminal":"non-terminal"])},T(g.name),3))),256)),La,(h(!0),p(M,null,Z(f.firstSet,g=>(h(),p("span",ka,T(g.name),1))),256)),ba]))),256))])):V("",!0)])):V("",!0)]),l("div",Ta,[l("div",Ea,T(e.t("LR.ClosureModal.Closure")),1),(h(!0),p(M,null,Z(e.closure,(f,g)=>(h(),p("div",$a,[X(r,{"lr-item":f.item,class:j(["lr-item",g===e.idx?f.highlight?"lr-item-highlight-stripes":"lr-item-highlight-gold":f.highlight?"lr-item-highlight-green":""])},null,8,["lr-item","class"]),q(l("span",Ra,"\u2192",512),[[Q,g===e.idx]])]))),256))])]),_:1},8,["visible","title"])}var Ia=ce(ha,[["render",Aa],["__scopeId","data-v-c1d55a22"]]);const wt=16,St=8,Lt=16,tt=8,Re=12,fe=48,Ye=32,Ca=4,kt=Re/2;function bt(e,t,s,n){return{state:e,top:t,left:s,column:n,linesIn:[],linesToLeft:[],linesToRight:[],linesToSameColumn:[],linesToSelf:[],hidden:!1,merged:!1,highlight:"normal"}}function Vt(e){return{stateIds:e===void 0?[]:e,left:0,height:fe,width:fe,linesPassByRight:[],linesPassByLeft:[],linesPassByBottom:[]}}let Wt=-1;function st(e,t,s,n){return++Wt,{id:Wt,symbol:e,from:t,to:s,type:n,points:[[0,0]],hidden:!1,highlight:"normal"}}const Pa=ie({components:{ClosureModal:Ia,FirstSetTable:ns,StateItem:aa,GLoading:Qt},setup(){const{t:e}=Ze({useScope:"global"}),t=Qe(),s=Je(),n=he(()=>t.automatonLoading),o=new Map,u=L(0),i=L(0),a=L(new Map),r=L(new Map),d=[];function c(m){t.stateFlags[m]={active:!1,closureDone:!1,appended:!1}}function f(){const m=s.automaton.states[0];a.value.set(m.id,bt(m,0,0,0)),d.push(Vt([m.id])),Te(()=>{const b=o.get(0);d[0].width=b.offsetWidth,d[0].height=b.offsetHeight})}f();async function g(m,b){let v=a.value.get(m).column,E=d[v],y=0;for(;y<E.stateIds.length&&E.stateIds[y]!==m;y++);let C=o.get(m),w=C.offsetTop+C.offsetHeight;for(y+=1;y<E.stateIds.length;y++){let B=o.get(E.stateIds[y]),le=a.value.get(E.stateIds[y]);le.top=w+Ye,w+=Ye+B.offsetHeight}E.width=Math.max(E.width,C.offsetWidth),E.height=w,u.value=Math.max(u.value,E.height+fe+Re*E.linesPassByBottom.length),i.value=Math.max(i.value,E.left+E.width+fe+Re*E.linesPassByRight.length),b&&await O(v+1)}async function I(m){t.stateFlags[m.from].appended=!0;let b=a.value.get(m.from).column,v=d[b],E=b+1,y=d[E];y===void 0&&(y=Vt(),d.push(y));let C=[],w=[],B=[],le=[],Le=E;const Se=v.stateIds.length,_e=5;m.targets.forEach(z=>{if(a.value.has(z.state.id)){let U=a.value.get(z.state.id).column;Le=Math.min(Le,U),U<b?C.push(z):U>b?w.push(z):z.state.id===m.from?le.push(z):B.push(z)}else c(z.state.id),b!=0&&v.stateIds.length<_e?(a.value.set(z.state.id,bt(z.state,0,0,b)),v.stateIds.push(z.state.id),B.push(z)):(a.value.set(z.state.id,bt(z.state,0,0,E)),y.stateIds.push(z.state.id),w.push(z))});let be=[];for(let z=0;z<w.length;z++){let U=st(w[z].symbol,m.from,w[z].state.id,"Right");r.value.set(U.id,U),a.value.get(U.from).linesToRight.push(U.id),a.value.get(U.to).linesIn.push(U.id),be.push(U.id)}v.linesPassByRight.push(...be.reverse());for(let z=0;z<C.length;z++){let U=st(C[z].symbol,m.from,C[z].state.id,"Left");r.value.set(U.id,U);let De=a.value.get(U.from),$e=a.value.get(U.to);De.linesToLeft.push(U.id),$e.linesIn.push(U.id),v.linesPassByRight.push(U.id);for(let ht=De.column;ht>=$e.column;ht--)d[ht].linesPassByBottom.push(U.id);d[$e.column].linesPassByLeft.push(U.id)}be=[];for(let z=0;z<B.length;z++){let U=st(B[z].symbol,m.from,B[z].state.id,"SameColumn");r.value.set(U.id,U),a.value.get(U.from).linesToSameColumn.push(U.id),a.value.get(U.to).linesIn.push(U.id),be.push(U.id)}if(v.linesPassByLeft.push(...be.reverse()),le.length!==0){let z=st(le[0].symbol,m.from,m.from,"Self");r.value.set(z.id,z),a.value.get(z.from).linesToSelf.push(z.id)}const ze=o.get(v.stateIds[Se-1]);let ge=ze.offsetTop+ze.offsetHeight;for(let z=Se;z<v.stateIds.length;z++){const U=v.stateIds[z],De=a.value.get(U);De.left=v.left,De.top=ge+Ye,await Te();let $e=o.get(U);ge=$e.offsetTop+$e.offsetHeight,v.width=Math.max(v.width,$e.offsetWidth)}u.value=Math.max(u.value,ge),i.value=Math.max(i.value,v.left+v.width),v.height=ge;let as=fe*2+Re*Math.max(v.linesPassByRight.length,y.linesPassByLeft.length);ge=-Ye,y.left=v.left+v.width+as;for(let z=0;z<y.stateIds.length;z++){let U=y.stateIds[z],De=a.value.get(U);De.left=y.left,De.top=ge+Ye,await Te();let $e=o.get(U);ge=$e.offsetTop+$e.offsetHeight,y.width=Math.max(y.width,$e.offsetWidth)}u.value=Math.max(u.value,ge),i.value=Math.max(i.value,y.left+y.width),y.height=ge>0?ge:0,await O(Le)}async function O(m){for(let E=m;E<d.length;E++){let y=fe*2+Re*Math.max(d[E-1].linesPassByRight.length,d[E].linesPassByLeft.length),C=d[E-1].left+d[E-1].width+y,w=C-d[E].left;w!==0&&(d[E].left+=w,d[E].stateIds.forEach(B=>{a.value.get(B).left=C}))}await Te();const b=d[d.length-1];i.value=Math.max(i.value,b.left+b.width+fe+Re*b.linesPassByRight.length);const v=[];return r.value.forEach((E,y)=>v.push(P(y))),Promise.all(v)}async function P(m){let b=r.value.get(m),v=a.value.get(b.from),E=a.value.get(b.to),y=o.get(b.from),C=o.get(b.to),w=[];if(b.type==="Right"){let B=y.offsetLeft+y.offsetWidth,le=y.offsetTop+Lt+wt*v.linesToRight.indexOf(m),Le=C.offsetLeft,Se=C.offsetTop+tt+St*E.linesIn.indexOf(m),_e=d[v.column].left+d[v.column].width+fe+Re*d[v.column].linesPassByRight.indexOf(m);i.value=Math.max(i.value,_e+fe),w.push([B,le]),w.push([_e,le]),w.push([_e,Se]),w.push([Le,Se])}else if(b.type==="Left"){let B=y.offsetLeft+y.offsetWidth,le=y.offsetTop+y.offsetHeight-Lt-wt*v.linesToLeft.indexOf(m),Le=C.offsetLeft,Se=C.offsetTop+tt+St*E.linesIn.indexOf(m),_e=d[v.column].left+d[v.column].width+fe+Re*d[v.column].linesPassByRight.indexOf(m),be=Le-fe-kt-Re*d[E.column].linesPassByLeft.indexOf(m),ze=0;for(let ge=v.column;ge>=E.column;ge--)ze=Math.max(ze,d[ge].height+fe+Re*d[ge].linesPassByBottom.indexOf(m));i.value=Math.max(i.value,_e+fe),u.value=Math.max(u.value,ze+fe),w.push([B,le]),w.push([_e,le]),w.push([_e,ze]),w.push([be,ze]),w.push([be,Se]),w.push([Le,Se])}else if(b.type==="SameColumn"){let B=y.offsetLeft,le=y.offsetTop+y.offsetHeight-tt-wt*(v.linesToSameColumn.indexOf(m)+1),Le=B,Se=C.offsetTop+tt+St*E.linesIn.indexOf(m),_e=B-fe-kt-Re*d[v.column].linesPassByLeft.indexOf(m);w.push([B,le]),w.push([_e,le]),w.push([_e,Se]),w.push([Le,Se])}else{let B=y.offsetLeft,le=y.offsetTop+y.offsetHeight-tt,Le=y.offsetLeft+Lt,Se=y.offsetTop+y.offsetHeight,_e=B-fe+kt,be=Se+Ye/2;u.value=Math.max(u.value,be+fe),w.push([B,le]),w.push([_e,le]),w.push([_e,be]),w.push([Le,be]),w.push([Le,Se])}return b.points=w,Te()}function G(m){const b=r.value.get(m),v=a.value.get(b.from),E=a.value.get(b.to),y=d[v.column],C=d[E.column];if(b.type==="Left"){y.linesPassByRight.splice(y.linesPassByRight.indexOf(m),1),C.linesPassByLeft.splice(C.linesPassByLeft.indexOf(m),1);for(let w=E.column;w<=v.column;w++){const B=d[w];B.linesPassByBottom.splice(B.linesPassByBottom.indexOf(m),1)}v.linesToLeft.splice(v.linesToLeft.indexOf(m),1),E.linesIn.splice(E.linesIn.indexOf(m),1)}else b.type==="Right"?(y.linesPassByRight.splice(y.linesPassByRight.indexOf(m),1),v.linesToRight.splice(v.linesToRight.indexOf(m),1),E.linesIn.splice(E.linesIn.indexOf(m),1)):b.type==="SameColumn"?(y.linesPassByLeft.splice(y.linesPassByLeft.indexOf(m),1),v.linesToSameColumn.splice(v.linesToSameColumn.indexOf(m),1),E.linesIn.splice(E.linesIn.indexOf(m),1)):v.linesToSelf.splice(v.linesToSelf.indexOf(m),1);r.value.delete(m)}async function W(m){m.mergeMap.forEach((v,E)=>{const y=a.value.get(E),C=function(w){for(;w.length>0;)G(w[w.length-1])};C(y.linesIn),C(y.linesToLeft),C(y.linesToRight),C(y.linesToSameColumn),C(y.linesToSelf),y.merged=!0}),m.transitionChanges.forEach((v,E)=>{v.forEach(y=>{let C=a.value.get(E),w=a.value.get(y.to);const B=st(y.symbol,E,y.to,C.column===w.column?"SameColumn":C.column<w.column?"Right":"Left");if(r.value.set(B.id,B),B.type==="Left"){C.linesToLeft.push(B.id),w.linesIn.push(B.id),d[C.column].linesPassByRight.push(B.id),d[w.column].linesPassByLeft.push(B.id);for(let le=w.column;le<=C.column;le++)d[le].linesPassByBottom.push(B.id)}else B.type==="Right"?(C.linesToRight.push(B.id),w.linesIn.push(B.id),d[C.column].linesPassByRight.push(B.id)):(C.linesToSameColumn.push(B.id),w.linesIn.push(B.id),d[C.column].linesPassByLeft.push(B.id))})});const b=[];m.mergeMap.forEach((v,E)=>{b.push(re.publish("lr","State"+v+"MergeLr1",E))}),await Promise.all(b),await O(1)}const ee=[],pe=[];function oe(m){if(ee.forEach(b=>{const v=a.value.get(b);v.highlight="normal"}),pe.forEach(b=>{const v=r.value.get(b);v.highlight="normal"}),ee.splice(0),pe.splice(0),m.action.name==="Shift"||m.action.name==="Goto"){const b=a.value.get(m.actionSource.stateId);b.highlight="green";const v=a.value.get(m.currentStateId);v.highlight="gold",ee.push(m.actionSource.stateId,m.currentStateId);for(let E=0;E<v.linesIn.length;E++){const y=r.value.get(v.linesIn[E]);if(y.from===m.actionSource.stateId){y.highlight="green",pe.push(v.linesIn[E]);break}}}else if(m.action.name==="Reduce"){const b=a.value.get(m.currentStateId);b.highlight="gold",ee.push(m.currentStateId);for(let v=m.stateStackDiff.length-1;v>=0;v--){const E=m.stateStackDiff[v],y=a.value.get(E);if(v>0)for(let C=0;C<y.linesIn.length;C++){const w=r.value.get(y.linesIn[C]);if(w.from===m.stateStackDiff[v-1]){w.highlight="brown",pe.push(y.linesIn[C]);break}}else for(let C=0;C<y.linesIn.length;C++){const w=r.value.get(y.linesIn[C]);w.from===m.currentStateId&&(w.highlight="brown",pe.push(y.linesIn[C]))}y.highlight="brown",ee.push(E)}}else{const b=a.value.get(m.currentStateId);b.highlight="gold",ee.push(m.currentStateId)}}const _=[re.subscribe("lr","AutomatonAppendStates",I),re.subscribe("lr","AutomatonMergeLr1States",W),re.subscribe("lr","AutomatonStatesPath",oe)];We(()=>{_.forEach(m=>m())});function x(m){if(m.merged)return;a.value.forEach(v=>v.hidden=!0),r.value.forEach(v=>v.hidden=!0),m.hidden=!1;const b=function(v){v.forEach(E=>{let y=r.value.get(E);y.hidden=!1;let C=a.value.get(y.to);C.hidden=!1})};b(m.linesToLeft),b(m.linesToRight),b(m.linesToSameColumn),b(m.linesToSelf)}function te(m){m.merged||(a.value.forEach(b=>b.hidden=!1),r.value.forEach(b=>b.hidden=!1))}function Pe(m){a.value.forEach((b,v)=>{v===m.from||v===m.to||(b.hidden=!0)}),r.value.forEach((b,v)=>{v!==m.id&&(b.hidden=!0)})}function we(){a.value.forEach(m=>m.hidden=!1),r.value.forEach(m=>m.hidden=!1)}function H(m){!t.manual||m.merged||(Object.entries(t.stateFlags).forEach(b=>{Number.parseInt(b[0])===m.state.id?b[1].active=!0:b[1].active=!1}),t.currentStateId=m.state.id)}const N=L();let ue=!1,xe=0,Oe=0,Ne=0,me=0;function Ge(m){xe=m.pageX,Oe=m.pageY,me=N.value.scrollLeft,Ne=N.value.scrollTop,ue=!0,document.addEventListener("mousemove",Ee),document.addEventListener("mouseup",K)}function Ee(m){if(ue){let b=m.pageX-xe,v=m.pageY-Oe;N.value.scrollLeft=me-b,N.value.scrollTop=Ne-v}}function K(){ue=!1,me=N.value.scrollLeft,Ne=N.value.scrollTop,document.removeEventListener("mousemove",Ee),document.removeEventListener("mouseup",K)}He(()=>{N.value.addEventListener("mousedown",Ge)});const k=L(!0);function R(){k.value=!k.value}const A=new Map;function Y(){const{firstSet:m,nullable:b,SYMBOL_EPSILON:v}=s.getFirstSet();m.forEach((E,y)=>{if(y.isTerm)return;const C=Array.from(E);b.has(y)&&C.push(v),A.set(y,C)})}t.algorithm!=="LR0"&&Y();const F=L(100);function se(m){if(m===void 0){F.value=100;return}F.value<=20&&m<0||(F.value+=m)}return{t:e,automatonLoading:n,stateItems:a,lineBlocks:r,displayPanel:N,updateState:g,stateRefs:o,GAP_ARROW:Ca,totalHeight:u,totalWidth:i,handleStateMouseEnter:x,handleStateMouseLeave:te,handleLineMouseEnter:Pe,handleLineMouseLeave:we,handleStateClick:H,algorithm:t.algorithm,showFirstSetTable:k,changeShowFirstSetTable:R,firstSetWithNullable:A,zoom:F,adjustZoom:se}}}),Ct=e=>(Ie("data-v-2c7549df"),e=e(),Ce(),e),xa={class:"automaton-display-panel",ref:"displayPanel"},Ma=["onMouseenter","onMouseleave","onClick"],Oa={style:{position:"absolute",top:"0",width:"100%",height:"100%"}},Na=["onMouseenter"],za=["x","y"],Da=["points"],Ba={key:0,class:"first-set-panel"},Ga={class:"first-set-header"},Ha={class:"zoom-panel"},Fa=Ct(()=>l("i",{class:"bi bi-zoom-in"},null,-1)),Ua=[Fa],Va=Ct(()=>l("i",{class:"bi bi-zoom-out"},null,-1)),Wa=[Va],Ya=Ct(()=>l("i",{class:"bi bi-arrow-clockwise"},null,-1)),qa=[Ya];function Xa(e,t,s,n,o,u){const i=ne("StateItem"),a=ne("FirstSetTable"),r=ne("GLoading"),d=ne("ClosureModal");return h(),p(M,null,[l("div",xa,[l("div",{style:Ae({position:"relative",height:e.totalHeight+"px",width:e.totalWidth+"px",transform:"scale("+e.zoom+"%)",transformOrigin:"0px 0px"})},[(h(!0),p(M,null,Z(e.stateItems,c=>(h(),p("div",{key:c[0],ref_for:!0,ref:f=>{e.stateRefs.set(c[1].state.id,f)},style:Ae({position:"absolute",top:c[1].top+"px",left:c[1].left+"px"}),class:j([[c[1].hidden?"hidden":"",c[1].merged?"merged":""],"state-item-container"]),onMouseenter:f=>e.handleStateMouseEnter(c[1]),onMouseleave:f=>e.handleStateMouseLeave(c[1]),onClick:f=>e.handleStateClick(c[1])},[X(i,{state:c[1].state,"state-item-data":c[1],onUpdateState:e.updateState},null,8,["state","state-item-data","onUpdateState"])],46,Ma))),128)),(h(),p("svg",Oa,[(h(!0),p(M,null,Z(e.lineBlocks,c=>(h(),p("g",{key:c[0],class:j(c[1].hidden?"hidden":""),onMouseenter:f=>e.handleLineMouseEnter(c[1]),onMouseleave:t[0]||(t[0]=f=>e.handleLineMouseLeave())},[l("text",{class:j([c[1].symbol.isTerm?"terminal":"non-terminal",c[1].type==="SameColumn"||c[1].type==="Self"?"line-text-shift":"","line-text"]),x:c[1].points[0][0],y:c[1].points[0][1]},T(c[1].symbol.name),11,za),l("polyline",{points:c[1].points.join(" ")+" "+(c[1].type==="Self"?c[1].points[c[1].points.length-1][0]-e.GAP_ARROW+","+(c[1].points[c[1].points.length-1][1]+e.GAP_ARROW)+" "+c[1].points[c[1].points.length-1][0]+","+c[1].points[c[1].points.length-1][1]+" "+(c[1].points[c[1].points.length-1][0]+e.GAP_ARROW)+","+(c[1].points[c[1].points.length-1][1]+e.GAP_ARROW)+" ":c[1].points[c[1].points.length-1][0]-e.GAP_ARROW+","+(c[1].points[c[1].points.length-1][1]-e.GAP_ARROW)+" "+c[1].points[c[1].points.length-1][0]+","+c[1].points[c[1].points.length-1][1]+" "+(c[1].points[c[1].points.length-1][0]-e.GAP_ARROW)+","+(c[1].points[c[1].points.length-1][1]+e.GAP_ARROW)+" "),class:j(["state-goto-line",c[1].highlight==="normal"?"":"state-goto-line-highlight-"+c[1].highlight])},null,10,Da)],42,Na))),128))]))],4)],512),e.algorithm!=="LR0"?(h(),p("div",Ba,[l("div",Ga,[l("span",null,T(e.t("LR.Automaton.FirstSet")),1),l("span",{class:"first-set-table-btn",onClick:t[1]||(t[1]=(...c)=>e.changeShowFirstSetTable&&e.changeShowFirstSetTable(...c))},T(e.showFirstSetTable?">":"<"),1)]),q(X(a,{"first-set":e.firstSetWithNullable,style:{"max-width":"300px","max-height":"200px"}},null,8,["first-set"]),[[Q,e.showFirstSetTable]])])):V("",!0),l("div",Ha,[l("span",{onClick:t[2]||(t[2]=c=>e.adjustZoom(10))},Ua),l("span",{onClick:t[3]||(t[3]=c=>e.adjustZoom(-10))},Wa),l("span",{onClick:t[4]||(t[4]=c=>e.adjustZoom())},qa)]),e.automatonLoading?(h(),ye(r,{key:1,text:e.t("LR.Automaton.Calculating")},null,8,["text"])):V("",!0),X(d,{"first-set":e.firstSetWithNullable},null,8,["first-set"])],64)}var ja=ce(Pa,[["render",Xa],["__scopeId","data-v-2c7549df"]]);const Ka=ie({setup(){const e=L([]),t=L(new Map);let s;const n=Je();n.parseTable.actionTable.forEach((d,c)=>{let f=[];const g=new Map;n.parseTable.actionHeader.forEach(I=>{let O=n.parseTable.actionTable.get(c).get(I),P;O===void 0?P={value:[],highlight:!1}:P={value:O,highlight:!1},f.push(P),g.set(I,P)}),n.parseTable.gotoHeader.forEach(I=>{let O=n.parseTable.gotoTable.get(c).get(I),P;O===void 0?P={value:[],highlight:!1}:P={value:O,highlight:!1},f.push(P),g.set(I,P)}),e.value.push([c,f]),t.value.set(c,g)});const o=n.parseTable.actionHeader.length,u=n.parseTable.gotoHeader.length,i=[...n.parseTable.actionHeader,...n.parseTable.gotoHeader];function a(d){s&&(t.value.get(s.stateId).get(s.symbol).highlight=!1),t.value.get(d.stateId).get(d.symbol).highlight=!0,s=d}const r=[re.subscribe("lr","ParseTableHighlight",a)];return We(()=>r.forEach(d=>d())),{actionHeaderCnt:o,gotoHeaderCnt:u,header:i,data:e}}}),Za=e=>(Ie("data-v-c98d5542"),e=e(),Ce(),e),Qa={class:"parse-table"},Ja=Za(()=>l("th",{rowspan:"2"},null,-1)),ei=["colspan"],ti=["colspan"],si={class:"non-terminal"},ni={key:0,class:"terminal"};function oi(e,t,s,n,o,u){return h(),p("table",Qa,[l("tr",null,[Ja,l("th",{class:"terminal",colspan:e.actionHeaderCnt},"ACTION",8,ei),l("th",{class:"terminal",colspan:e.gotoHeaderCnt},"GOTO",8,ti)]),l("tr",null,[(h(!0),p(M,null,Z(e.header,i=>(h(),p("th",{class:j([i.isTerm?"terminal":"non-terminal"])},T(i.name),3))),256))]),(h(!0),p(M,null,Z(e.data,i=>(h(),p("tr",null,[l("td",null,T(i[0]),1),(h(!0),p(M,null,Z(i[1],a=>(h(),p("td",{class:j([a.highlight?"grid-highlight":""])},[(h(!0),p(M,null,Z(a.value,(r,d)=>(h(),p("span",{class:j([d===0?"parse-action":"parse-action-unused"])},[l("span",si,T(r.abbr),1),r.name!=="Accept"?(h(),p("span",ni,T(r.arg),1)):V("",!0)],2))),256))],2))),256))]))),256))])}var ai=ce(Ka,[["render",oi],["__scopeId","data-v-c98d5542"]]);const Pt=ie({props:{mode:{type:String,default:"normal"},color1:{type:String,required:!0},color2:{type:String,required:!0}},setup(){const e=L([]),t=L([]);let s;const n=L(!1);function o(...r){n.value||(s=window.setTimeout(()=>{t.value.splice(0)},500)),n.value=!0,r.forEach(d=>e.value.push([Symbol(),d]))}function u(r){clearTimeout(s),t.value.splice(0),n.value=!1,t.value.push(...e.value.splice(-r,r))}const i=new Map;async function a(r,d){if(d===null){const I=i.get(r);I&&(clearInterval(I[1]),i.delete(r));return}if(i.get(r)!==void 0)return;await Te();const f=d.firstElementChild.offsetWidth-d.offsetWidth,g=function(I,O){let P=0;const G=15;return function(){P>=G+(O+1)+G+(O+1)&&(P=0),P<G||(P<G+(O+1)?I.style.transform="translateX(-"+(P-G)+"px)":P<G+(O+1)+G||P<G+(O+1)+G+(O+1)&&(I.style.transform="translateX(-"+(G+(O+1)+G+(O+1)-P-1)+"px)")),P++}};if(f>0){const I=window.setInterval(g(d.firstElementChild,f),80);i.set(r,[d,I])}}return{stackValues:e,desertedValues:t,hideDeserted:n,push:o,pop:u,handleUpdateBlock:a}}}),Yt=()=>{_s(e=>({"70d05909":e.color1,"70d0590a":e.color2}))},qt=Pt.setup;Pt.setup=qt?(e,t)=>(Yt(),qt(e,t)):Yt;const ii=Pt,li=e=>(Ie("data-v-618de97a"),e=e(),Ce(),e),ri={class:"parse-stack"},ui=["title"],ci=["title","innerHTML"],di=["title"],hi=["title","innerHTML"],fi=li(()=>l("div",{class:"stack-block stack-block-empty"},null,-1));function pi(e,t,s,n,o,u){return h(),p("div",ri,[(h(!0),p(M,null,Z(e.stackValues,(i,a)=>(h(),p("div",{key:i[0],class:j(["stack-block",a%2?"stack-block-odd":"stack-block-even"])},[l("div",{class:"stack-block-inner",ref_for:!0,ref:r=>e.handleUpdateBlock(i[0],r)},[e.mode==="normal"?(h(),p("div",{key:0,class:"stack-block-text",title:i[1].title},T(i[1].content),9,ui)):(h(),p("div",{key:1,class:"stack-block-text",title:i[1].title,innerHTML:i[1].content},null,8,ci))],512)],2))),128)),(h(!0),p(M,null,Z(e.desertedValues,(i,a)=>(h(),p("div",{key:i[0],class:j(["stack-block","stack-block-deserted",e.hideDeserted?"stack-block-hide":"",a%2?"stack-block-odd":"stack-block-even"])},[e.mode==="normal"?(h(),p("div",{key:0,class:"stack-block-text",title:i[1].title},T(i[1].content),9,di)):(h(),p("div",{key:1,class:"stack-block-text",title:i[1].title,innerHTML:i[1].content},null,8,hi))],2))),128)),fi])}var Xt=ce(ii,[["render",pi],["__scopeId","data-v-618de97a"]]);const xt=e=>(Ie("data-v-002d3d6a"),e=e(),Ce(),e),mi={class:"parse-message-container"},_i={class:"parse-operations"},gi={class:"non-terminal"},vi={class:"parse-current"},yi={class:"parse-current-text terminal"},wi={key:0},Si={class:"parse-current-text non-terminal"},Li={class:"zoom-panel"},ki=xt(()=>l("i",{class:"bi bi-zoom-in"},null,-1)),bi=[ki],Ti=xt(()=>l("i",{class:"bi bi-zoom-out"},null,-1)),Ei=[Ti],$i=xt(()=>l("i",{class:"bi bi-arrow-clockwise"},null,-1)),Ri=[$i],Ai={class:"parse-stack-container"},Ii={class:"parse-stack-title"},Ci={class:"parse-stack-title"},Pi=["width","height"],xi=["d"],Mi=["cx","cy","onClick"],Oi=["x","y"],Ni=ie({name:"parse-tree",setup(e){const{t}=Ze({useScope:"global"}),s=Je(),n=L(s.current),o=L(),u=L(),i=L(),a=60,r=60,d=8,c=20,f=30,g=200,I=L(g),O=L(g);class P{constructor(R,A,Y,F){S(this,"id",Symbol());S(this,"children");S(this,"symbol");S(this,"value");S(this,"x");S(this,"y");S(this,"path");S(this,"expand",!0);S(this,"visible",!0);this.symbol=R.symbol,this.value=R.value,this.x=A,this.y=Y,this.children=F||[]}shift(R,A){this.y+=R,this.shiftChildren(R,A),this.path!==void 0&&this.drawPath()}shiftChildren(R,A=0){this.children.length===0&&(O.value=Math.max(O.value,A*r+g)),this.children.forEach(Y=>Y.shift(R,A+1))}drawPath(){if(this.children.length===0)return;this.path===void 0&&(this.path=new G,pe.value.push(this.path));const R=this.children.map(se=>se.x),A=this.children[0].y,Y=Math.floor((this.y+A)/2);let F=`M ${this.x} ${this.y+d} V ${Y}`;for(let se=0;se<R.length;se++)F+=`M ${R[se]} ${Y} V ${A-d}`,se!==R.length-1&&(F+=`M ${R[se]} ${Y} H ${R[se+1]}`);this.path.pathStr=F}changeExpandShow(R){this.visible=R,(!R||this.expand)&&(this.path&&(this.path.visible=R),this.children.forEach(A=>A.changeExpandShow(R)))}changeExpand(){this.children.length!==0&&(this.expand=!this.expand,this.path&&(this.path.visible=this.expand),this.children.forEach(R=>R.changeExpandShow(this.expand)))}}class G{constructor(){S(this,"id",Symbol());S(this,"pathStr","");S(this,"visible",!0)}}const W=L([]),ee=[],pe=L([]);let oe=f-a;function _(k){let R=oe+a;oe=R,I.value=oe+g;const A=new P(k,R,f);W.value.push(A),ee.push(A)}function x(k,R){const A=ee.splice(-R,R);let Y=0;A.length>0?Y=Math.floor((A[0].x+A[A.length-1].x)/2):(Y=oe+a,oe=Y);const F=new P(k,Y,f,A);W.value.push(F),F.shiftChildren(r),ee.push(F),F.drawPath()}async function te(k){var R,A;if(k.action.name==="Shift"){o.value=k.action,k.stateStackDiff.forEach(F=>{var se;return(se=u.value)==null?void 0:se.push({content:'<span class="non-terminal">I</span><sub class="terminal">'+F.toString()+"</sub>"})}),k.valueStackDiff.forEach(F=>{var se;return(se=i.value)==null?void 0:se.push({title:F.symbol.name,content:'<span class="'+(F.symbol.isTerm?"terminal":"non-terminal")+'">'+F.symbol.name+"</span>"})});const Y=k.valueStackDiff[0];_(Y)}else k.action.name==="Reduce"?(o.value=k.action,(R=u.value)==null||R.pop(k.stateStackDiff.length),(A=i.value)==null||A.pop(k.valueStackDiff.length),x(k.next,k.valueStackDiff.length)):k.action.name==="Goto"?(o.value=k.action,k.stateStackDiff.forEach(Y=>{var F;return(F=u.value)==null?void 0:F.push({content:'<span class="non-terminal">I</span><sub class="terminal">'+Y.toString()+"</sub>"})}),k.valueStackDiff.forEach(Y=>{var F;return(F=i.value)==null?void 0:F.push({title:Y.symbol.name,content:'<span class="'+(Y.symbol.isTerm?"terminal":"non-terminal")+'">'+Y.symbol.name+"</span>"})})):o.value=k.action;n.value=k.next}He(()=>{var k,R;(k=u.value)==null||k.push({content:'<span class="non-terminal">I</span><sub class="terminal">0</sub>'}),(R=i.value)==null||R.push({title:Me.name,content:'<span class="terminal">'+Me.name+"</span>"})});const Pe=[re.subscribe("lr","ParseTreeStep",te)];We(()=>{Pe.forEach(k=>k())});const we=L();let H=!1,N=0,ue=0,xe=0,Oe=0;function Ne(k){k.preventDefault(),N=k.pageX,ue=k.pageY,Oe=we.value.scrollLeft,xe=we.value.scrollTop,H=!0,document.addEventListener("mousemove",me),document.addEventListener("mouseup",Ge)}function me(k){if(H){let R=k.pageX-N,A=k.pageY-ue;we.value.scrollLeft=Oe-R,we.value.scrollTop=xe-A}}function Ge(){H=!1,Oe=we.value.scrollLeft,xe=we.value.scrollTop,document.removeEventListener("mousemove",me),document.removeEventListener("mouseup",Ge)}He(()=>{we.value.addEventListener("mousedown",Ne)});const Ee=L(100);function K(k){if(k===void 0){Ee.value=100;return}Ee.value<=20&&k<0||(Ee.value+=k)}return(k,R)=>(h(),p(M,null,[l("div",mi,[l("div",_i,[o.value?(h(),p(M,{key:0},[l("span",null,T(D(t)("LR.ParseTree.Action"))+":\xA0",1),l("span",gi,T(o.value.abbr),1),q(l("span",{class:"terminal"},T(o.value.arg),513),[[Q,o.value.name!=="Accept"]]),o.value.name==="Reduce"?(h(),ye(At,{key:0,style:{"margin-left":"8px"},rule:o.value.rule},null,8,["rule"])):V("",!0)],64)):V("",!0)]),l("div",vi,[n.value instanceof D(je)?(h(),p(M,{key:0},[l("span",null,T(D(t)("LR.ParseTree.NextToken"))+":\xA0",1),l("div",yi,[l("span",null,T(n.value.type),1),n.value.type!==n.value.value?(h(),p("span",wi,"("+T(n.value.value)+")",1)):V("",!0)])],64)):(h(),p(M,{key:1},[l("span",null,T(D(t)("LR.ParseTree.NextSymbol"))+":\xA0",1),l("div",Si,[l("span",null,T(n.value.symbol.name),1)])],64))]),l("div",Li,[l("span",{onClick:R[0]||(R[0]=A=>K(10))},bi),l("span",{onClick:R[1]||(R[1]=A=>K(-10))},Ei),l("span",{onClick:R[2]||(R[2]=A=>K())},Ri)])]),l("div",Ai,[l("div",Ii,T(D(t)("LR.ParseTree.StateStack")),1),X(Xt,{ref_key:"stateStackRef",ref:u,style:{"margin-right":"8px"},mode:"html",color1:"#5976ba",color2:"#b0c4de"},null,512),l("div",Ci,T(D(t)("LR.ParseTree.SymbolStack")),1),X(Xt,{ref_key:"valueStackRef",ref:i,mode:"html",color1:"#68945c",color2:"#6fbe2c"},null,512)]),l("div",{class:"parse-tree",ref_key:"parseTreeRef",ref:we},[(h(),p("svg",{width:I.value,height:O.value,style:Ae({transform:"scale("+Ee.value+"%)",transformOrigin:"0px 0px"})},[(h(!0),p(M,null,Z(pe.value,A=>q((h(),p("path",{key:A.id,d:A.pathStr,class:"tree-path"},null,8,xi)),[[Q,A.visible]])),128)),(h(!0),p(M,null,Z(W.value,A=>q((h(),p("g",{key:A.id,class:"tree-node-group"},[l("circle",{cx:A.x,cy:A.y,r:d,class:j(["tree-node-circle",A.expand?"":"tree-node-solid"]),onClick:Y=>A.changeExpand()},null,10,Mi),l("text",{class:j(["tree-node-text",A.symbol.isTerm?"terminal":"non-terminal"]),x:A.x,y:A.y+c},T(A.symbol.name),11,Oi)])),[[Q,A.visible]])),128))],12,Pi))],512)],64))}});var zi=ce(Ni,[["__scopeId","data-v-002d3d6a"]]);const Di=ie({components:{InputPanel:Lo,ControlPanel:Mo,Automaton:ja,ParseTable:ai,ParseTree:zi,GWindow:kn,GLoading:Qt},props:{algo:{type:String}},setup(e){const{t}=Ze({useScope:"global"});gs((f,g,I)=>{if(f instanceof ae)yt({title:t("LR.Exception."+f.message)+(f.extra?f.extra:""),content:t("LR.Exception.ParserErrorExtra"),type:"error"});else if(f instanceof Fe)yt({title:t("LR.Exception."+f.message),content:"",type:"info"});else if(f instanceof at)yt({title:t("LR.Exception."+f.message),content:f.extra?f.extra:"",type:"error"});else return!0;return!1});const s=Qe(),n=L(!1),o=L("");function u(f){o.value=f}He(async()=>{await Is(u),n.value=!0});const i=he(()=>s.showControlPanel),a=he(()=>s.showAutomaton),r=he(()=>s.showParseTable),d=he(()=>s.showParseTree),c=he(()=>s.automatonLoading);return{t,larkLoaded:n,loadingMsg:o,showControlPanel:i,showAutomaton:a,showParseTable:r,showParseTree:d,automatonLoading:c}}}),Bi={key:1};function Gi(e,t,s,n,o,u){const i=ne("InputPanel"),a=ne("GWindow"),r=ne("Automaton"),d=ne("ParseTable"),c=ne("ParseTree"),f=ne("ControlPanel"),g=ne("GLoading");return e.larkLoaded?(h(),p(M,{key:0},[X(a,{id:"input",title:e.t("LR.InputPanel.Title"),"default-style":{height:"400px",marginBottom:"4px"},position:"absolute"},{default:de(()=>[X(i)]),_:1},8,["title"]),e.showAutomaton?(h(),ye(a,{key:0,id:"automaton",title:e.t("LR.Automaton.Title"),"default-style":{height:"80vh",marginBottom:"4px"},position:"absolute"},{default:de(()=>[X(r)]),_:1},8,["title"])):V("",!0),e.showParseTable?(h(),ye(a,{key:1,id:"parsetable",title:e.t("LR.ParseTable.Title"),"default-style":{width:"fit-content",height:"fit-content",maxWidth:"100%",marginBottom:"4px"},position:"absolute"},{default:de(()=>[X(d)]),_:1},8,["title"])):V("",!0),e.showParseTree?(h(),ye(a,{key:2,id:"parsetree",title:e.t("LR.ParseTree.Title"),"default-style":{height:"80vh"},position:"absolute"},{default:de(()=>[X(c)]),_:1},8,["title"])):V("",!0),e.showControlPanel?(h(),ye(f,{key:3})):V("",!0)],64)):(h(),p("div",Bi,[X(g,{text:[e.t("LR.LoadingDependecy"),e.t("LR.LoadingDependecyNotice"),e.loadingMsg]},null,8,["text"])]))}var Ui=ce(Di,[["render",Gi],["__scopeId","data-v-3bd2acb3"]]);export{Ui as default};
